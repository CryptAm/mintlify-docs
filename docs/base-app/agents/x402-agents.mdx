---
title: '–°–æ–∑–¥–∞–Ω–∏–µ –∞–≤—Ç–æ–Ω–æ–º–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ —Å x402'
description: –£–∑–Ω–∞–π—Ç–µ, –∫–∞–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞—Ç–µ–∂–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª x402 —Å —á–∞—Ç-–∞–≥–µ–Ω—Ç–∞–º–∏ XMTP –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∞–≤—Ç–æ–Ω–æ–º–Ω—ã—Ö —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
sidebarTitle: 'x402 –∏ –∞–≥–µ–Ω—Ç—ã'
---

x402 - —ç—Ç–æ —Ä–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–π –æ—Ç–∫—Ä—ã—Ç—ã–π –ø–ª–∞—Ç–µ–∂–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π Coinbase, –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–ª–∞—Ç–µ–∂–∏ —Å—Ç–µ–π–±–ª–∫–æ–∏–Ω–∞–º–∏ –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ HTTP. –û–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –ò–ò-–∞–≥–µ–Ω—Ç–∞–º –∞–≤—Ç–æ–Ω–æ–º–Ω–æ –æ–ø–ª–∞—á–∏–≤–∞—Ç—å —É—Å–ª—É–≥–∏ –±–µ–∑ –ø–æ–¥–ø–∏—Å–æ–∫ –∏–ª–∏ API-–∫–ª—é—á–µ–π, –æ—Ç–∫—Ä—ã–≤–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ-–Ω–∞—Å—Ç–æ—è—â–µ–º—É –∞–≤—Ç–æ–Ω–æ–º–Ω—ã—Ö, –º–æ–Ω–µ—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —á–∞—Ç-–∞–≥–µ–Ω—Ç–æ–≤, —Å–ø–æ—Å–æ–±–Ω—ã—Ö –ª–æ–≥–∏—á–µ—Å–∫–∏ –º—ã—Å–ª–∏—Ç—å, —Å–æ–≤–µ—Ä—à–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å —Ü–µ–Ω–Ω–æ—Å—Ç—å –±–µ—Å—à–æ–≤–Ω–æ.

## –ß—Ç–æ —Ç–∞–∫–æ–µ x402?

x402 —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å–ø–æ—Å–æ–± –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∞–≥–µ–Ω—Ç–æ–≤ —Å –ø–ª–∞—Ç–Ω—ã–º–∏ —É—Å–ª—É–≥–∞–º–∏, –≤—Å—Ç—Ä–∞–∏–≤–∞—è –ø–ª–∞—Ç–µ–∂–∏ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ HTTP-–∑–∞–ø—Ä–æ—Å—ã. –í–º–µ—Å—Ç–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è API-–∫–ª—é—á–∞–º–∏ –∏–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –≤–∞—à–∏ –∞–≥–µ–Ω—Ç—ã –º–æ–≥—É—Ç –ø–ª–∞—Ç–∏—Ç—å —Ä–æ–≤–Ω–æ –∑–∞ —Ç–æ, —á—Ç–æ –æ–Ω–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç, –∫–æ–≥–¥–∞ –æ–Ω–∏ —ç—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç.

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- **–ê–≤—Ç–æ–Ω–æ–º–Ω—ã–µ —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - –ê–≥–µ–Ω—Ç—ã –º–æ–≥—É—Ç —Å–æ–≤–µ—Ä—à–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±–µ–∑ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ —á–µ–ª–æ–≤–µ–∫–∞
- **–ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è –ø–æ —Ñ–∞–∫—Ç—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** - –ü–ª–∞—Ç–∏—Ç–µ —Ç–æ–ª—å–∫–æ –∑–∞ —Ä–µ–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —É—Å–ª—É–≥–∏
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞** - –ß–∞—Å—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—Å–µ–≥–æ –æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞ middleware
- **–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ** - –ü–ª–∞—Ç–µ–∂–∏ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –≤ –±–ª–æ–∫—á–µ–π–Ω–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## –ü–æ—Ç–æ–∫ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞

–ü–æ–Ω–∏–º–∞–Ω–∏–µ –ø–æ—Ç–æ–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π x402 –≤–∞–∂–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞–≤—Ç–æ–Ω–æ–º–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤:

<Steps>
<Step title="–ù–∞—á–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å">
  –ö–ª–∏–µ–Ω—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∑–∞—â–∏—â–µ–Ω–Ω–æ–º—É —Ä–µ—Å—É—Ä—Å—É.
</Step>

<Step title="–û—Ç–≤–µ—Ç "–¢—Ä–µ–±—É–µ—Ç—Å—è –æ–ø–ª–∞—Ç–∞"">
  –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å HTTP 402 —Å –¥–µ—Ç–∞–ª—è–º–∏ –ø–ª–∞—Ç–µ–∂–∞, –≤–∫–ª—é—á–∞—è:
  - –°—É–º–º—É –ø–ª–∞—Ç–µ–∂–∞
  - –ê–¥—Ä–µ—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è
  - –†–µ—Ñ–µ—Ä–µ–Ω—Å –ø–ª–∞—Ç–µ–∂–∞
</Step>

<Step title="–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞">
  –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–ª–∞—Ç–µ–∂–Ω—É—é –ø–æ–ª–µ–∑–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É —á–µ—Ä–µ–∑ HTTP-–∑–∞–≥–æ–ª–æ–≤–æ–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `X-PAYMENT`).
  
  <Note>
  –ü–ª–∞—Ç–µ–∂–Ω—ã–π —Ñ–∞—Å–∏–ª–∏—Ç–∞—Ç–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –≤ –±–ª–æ–∫—á–µ–π–Ω–µ.
  </Note>
</Step>

<Step title="–î–æ—Å—Ç–∞–≤–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞">
  –ö–ª–∏–µ–Ω—Ç –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –∏—Å—Ö–æ–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å, –∏ —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç:
  - –ó–∞–ø—Ä–æ—à–µ–Ω–Ω—ã–º –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º 
  - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –ø–ª–∞—Ç–µ–∂–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `X-PAYMENT-RESPONSE`)
</Step>
</Steps>

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è x402 —Å –∞–≥–µ–Ω—Ç–∞–º–∏ XMTP

–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ x402 —Å —á–∞—Ç-–∞–≥–µ–Ω—Ç–∞–º–∏ XMTP —Å–æ–∑–¥–∞—ë—Ç –º–æ—â–Ω—ã—Ö –∞–≤—Ç–æ–Ω–æ–º–Ω—ã—Ö —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤. –í–æ—Ç –∫–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç—Ç—É –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é:

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–≥–µ–Ω—Ç–∞

–í–∞—à –∞–≥–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è:

1. **–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –Ω–µ —Ç—Ä–µ–±—É—é—â–∏–µ –æ–ø–ª–∞—Ç—ã
2. **–ü–ª–∞—Ç–µ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** - –ü—Ä–µ–º–∏—É–º-—Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—É—Å–∫–∞—é—Ç –ø–ª–∞—Ç–µ–∂–∏ x402
3. **–°–±–æ–∏ –ø–ª–∞—Ç–µ–∂–µ–π** - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–∏ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–∞—Ö

### –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

–í–æ—Ç –∫–∞–∫ –≤–∞—à –∞–≥–µ–Ω—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç–µ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º SDK –∞–≥–µ–Ω—Ç–∞:

```typescript
import { Agent } from '@xmtp/agent-sdk';
import { PaymentFacilitator } from '@coinbase/x402-sdk';

// –°–æ–∑–¥–∞—Ç—å –∞–≥–µ–Ω—Ç–∞
const agent = await Agent.createFromEnv({
  env: 'production',
});

// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø—Ä–µ–º–∏—É–º-—Ñ—É–Ω–∫—Ü–∏—è–º–∏
agent.on('text', async (ctx) => {
  const message = ctx.message.content;
  
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–º–∏—É–º-—Ñ—É–Ω–∫—Ü–∏—é
  if (message.includes('floor price')) {
    await handlePremiumRequest(ctx);
  }
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞—Ç–µ–∂–Ω—ã–π —Ñ–∞—Å–∏–ª–∏—Ç–∞—Ç–æ—Ä
const facilitator = new PaymentFacilitator({
  privateKey: process.env.XMTP_WALLET_KEY!,
  network: process.env.NETWORK || 'base'
});

// –ê–≥–µ–Ω—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç–µ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
async function handlePremiumRequest(ctx: any) {
  try {
    const endpoint = "/premium-api/nft-floor-price";
    const response = await fetch(endpoint);

    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Ç—Ä–µ–±—É–µ—Ç—Å—è –ª–∏ –æ–ø–ª–∞—Ç–∞
    if (response.status === 402) {
      const paymentDetails = await response.json();
      
      // –£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–∏ –æ–ø–ª–∞—Ç—ã
      await ctx.sendText(`üí∞ Payment required: ${paymentDetails.amount} USDC. Processing...`);
      
      // –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–ª–∞—Ç–µ–∂
      const payment = await facilitator.createPayment({
        amount: paymentDetails.amount,
        recipient: paymentDetails.recipient,
        reference: paymentDetails.reference,
        currency: 'USDC'
      });
      
      // –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å —Å –ø–ª–∞—Ç–µ–∂–æ–º
      const retryResponse = await fetch(endpoint, {
        headers: { "X-PAYMENT": payment.payload }
      });

      if (retryResponse.ok) {
        const data = await retryResponse.json();
        await ctx.sendText(`üìä NFT floor price: ${data.floorPrice} ETH`);
      } else {
        await ctx.sendText("‚ùå Payment processed but service unavailable. Please try again.");
      }
    } else if (response.ok) {
      // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–≤–µ—Ç –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ —É—Ä–æ–≤–Ω—è
      const data = await response.json();
      await ctx.sendText(`üìä NFT floor price: ${data.floorPrice} ETH`);
    }
  } catch (error) {
    await ctx.sendText("‚ùå Unable to fetch data. Please try again later.");
  }
}
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
XMTP_WALLET_KEY= # –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –∫–æ—à–µ–ª—å–∫–∞
XMTP_DB_ENCRYPTION_KEY= # –∫–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
XMTP_ENV=production # local, dev, production
NETWORK=base # –±–ª–æ–∫—á–µ–π–Ω-—Å–µ—Ç—å –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π
```

### –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∞–≥–µ–Ω—Ç–∞

–í–æ—Ç –ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è, –æ–±—ä–µ–¥–∏–Ω—è—é—â–∞—è XMTP —Å x402:

<CodeGroup>
```typescript Complete Agent
import { Agent } from '@xmtp/agent-sdk';
import { PaymentFacilitator } from '@coinbase/x402-sdk';

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞—Ç–µ–∂–Ω—ã–π —Ñ–∞—Å–∏–ª–∏—Ç–∞—Ç–æ—Ä
const facilitator = new PaymentFacilitator({
  privateKey: process.env.XMTP_WALLET_KEY!,
  network: process.env.NETWORK || 'base'
});

// –°–æ–∑–¥–∞—Ç—å –∞–≥–µ–Ω—Ç–∞
const agent = await Agent.createFromEnv({
  env: 'production', // Base app —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ production
});

// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
agent.on('text', async (ctx) => {
  const content = ctx.message.content.toLowerCase();

  // –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
  if (content.includes('floor price')) {
    await handleFloorPriceRequest(ctx, content);
  } else if (content.includes('market data')) {
    await handleMarketDataRequest(ctx, content);
  } else {
    await ctx.sendText("Hi! I can help with:\n‚Ä¢ NFT floor prices\n‚Ä¢ Market data\n\nJust ask!");
  }
});

// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã floor NFT
async function handleFloorPriceRequest(ctx: any, content: string) {
  // –ò–∑–≤–ª–µ—á—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
  const collection = extractCollection(content);
  
  if (!collection) {
    await ctx.sendText("Please specify an NFT collection name.");
    return;
  }

  try {
    const response = await fetch(`/api/nft-floor/${collection}`);
    
    if (response.status === 402) {
      await processPaymentAndRetry(
        ctx,
        `/api/nft-floor/${collection}`,
        `üìä Floor price for ${collection}:`
      );
    } else if (response.ok) {
      const data = await response.json();
      await ctx.sendText(`üìä ${collection} floor price: ${data.floorPrice} ETH`);
    }
  } catch (error) {
    await ctx.sendText("‚ùå Unable to fetch floor price data.");
  }
}

// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
async function handleMarketDataRequest(ctx: any, content: string) {
  const symbol = extractSymbol(content);
  
  if (!symbol) {
    await ctx.sendText("Please specify a token symbol (e.g., BTC, ETH).");
    return;
  }

  try {
    const response = await fetch(`/api/market-data/${symbol}`);
    
    if (response.status === 402) {
      await processPaymentAndRetry(
        ctx,
        `/api/market-data/${symbol}`,
        `üíπ Market data for ${symbol.toUpperCase()}:`
      );
    } else if (response.ok) {
      const data = await response.json();
      await ctx.sendText(`üíπ ${symbol.toUpperCase()} - Price: $${data.price} | 24h: ${data.change24h}%`);
    }
  } catch (error) {
    await ctx.sendText("‚ùå Unable to fetch market data.");
  }
}

// –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–ª–∞—Ç–µ–∂ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å
async function processPaymentAndRetry(ctx: any, endpoint: string, successPrefix: string) {
  try {
    // –ù–∞—á–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π –ø–ª–∞—Ç–µ–∂–∞
    const response = await fetch(endpoint);
    const paymentDetails = await response.json();
    
    // –£–≤–µ–¥–æ–º–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –ø–ª–∞—Ç–µ–∂–µ
    await ctx.sendText(`üí∞ Payment required: ${paymentDetails.amount} USDC. Processing...`);
    
    // –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–ª–∞—Ç–µ–∂
    const payment = await facilitator.createPayment({
      amount: paymentDetails.amount,
      recipient: paymentDetails.recipient,
      reference: paymentDetails.reference,
      currency: 'USDC'
    });
    
    // –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Å –ø–ª–∞—Ç–µ–∂–æ–º
    const retryResponse = await fetch(endpoint, {
      headers: { "X-PAYMENT": payment.payload }
    });
    
    if (retryResponse.ok) {
      const data = await retryResponse.json();
      await ctx.sendText(`${successPrefix} ${JSON.stringify(data, null, 2)}`);
    } else {
      await ctx.sendText("‚ùå Payment processed but service error occurred.");
    }
  } catch (error) {
    await ctx.sendText(`‚ùå Payment failed: ${error.message}`);
  }
}

// –ò–∑–≤–ª–µ—á—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
function extractCollection(content: string): string | null {
  const words = content.toLowerCase().split(' ');
  const collectionIndex = words.findIndex(word => 
    ['cryptopunks', 'bayc', 'azuki', 'pudgypenguins'].includes(word)
  );
  return collectionIndex !== -1 ? words[collectionIndex] : null;
}

// –ò–∑–≤–ª–µ—á—å —Å–∏–º–≤–æ–ª —Ç–æ–∫–µ–Ω–∞ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è
function extractSymbol(content: string): string | null {
  const words = content.toLowerCase().split(' ');
  const symbolIndex = words.findIndex(word => 
    ['btc', 'eth', 'usdc', 'base'].includes(word)
  );
  return symbolIndex !== -1 ? words[symbolIndex] : null;
}

// –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≥–µ–Ω—Ç–∞
agent.on('start', () => {
  console.log('Autonomous Payment Agent started!');
  console.log(`Agent address: ${agent.address}`);
});

await agent.start();
```

```typescript Server Setup
import express from 'express';
import { paymentMiddleware } from '@coinbase/x402-middleware';

const app = express();

// –ü—Ä–∏–º–µ–Ω–∏—Ç—å x402 middleware
app.use(paymentMiddleware(process.env.PAYMENT_ADDRESS, {
  "/api/nft-floor/*": "$0.01",
  "/api/market-data/*": "$0.005"
}));

// –ó–∞—â–∏—â—ë–Ω–Ω—ã–µ –∫–æ–Ω–µ—á–Ω—ã–µ —Ç–æ—á–∫–∏ (endpoint)
app.get('/api/nft-floor/:collection', (req, res) => {
  // This endpoint is now payment-gated
  const mockData = {
    collection: req.params.collection,
    floorPrice: (Math.random() * 10).toFixed(3),
    currency: 'ETH',
    timestamp: new Date().toISOString()
  };
  
  res.json(mockData);
});

app.get('/api/market-data/:symbol', (req, res) => {
  const mockData = {
    symbol: req.params.symbol,
    price: (Math.random() * 1000).toFixed(2),
    change24h: ((Math.random() - 0.5) * 20).toFixed(2),
    volume: Math.floor(Math.random() * 1000000)
  };
  
  res.json(mockData);
});

app.listen(3000, () => {
  console.log('x402-enabled API server running on port 3000');
});
```
</CodeGroup>

## –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã

–ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–µ–∫—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏ x402 —Å –∞–≥–µ–Ω—Ç–∞–º–∏ XMTP:

### Stableburn x402

–†–∞–±–æ—á–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∞—è:
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é XMTP v4
- –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å AgentKit
- –ú–∏–∫—Ä–æ–ø–ª–∞—Ç–µ–∂–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ x402 ($0.001‚Äì$0.005 –∑–∞ –∑–∞–ø—Ä–æ—Å)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∂–∏–≥–∞–Ω–∏–µ –≤—ã—Ä—É—á–∫–∏ —á–µ—Ä–µ–∑ —Å–≤–æ–ø—ã —Ç–æ–∫–µ–Ω–æ–≤ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ

<Card title="Stableburn x402" icon="fire" href="https://github.com/example/stableburn-x402">
  –ê–≤—Ç–æ–Ω–æ–º–Ω—ã–π –∞–≥–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –º–æ–Ω–µ—Ç–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–µ–º–∏—É–º-–∫–æ–Ω–µ—á–Ω—ã–µ —Ç–æ—á–∫–∏ —Å –ø–æ–º–æ—â—å—é –º–∏–∫—Ä–æ–ø–ª–∞—Ç–µ–∂–µ–π
</Card>

### Crossmint Worldstore Agent

–ß–∞—Ç-–∞–≥–µ–Ω—Ç XMTP –¥–ª—è –ø–æ–∫—É–ø–æ–∫, –≤–∫–ª—é—á–∞—é—â–∏–π:
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –ø–ª–∞—Ç–µ–∂–µ–π x402
- –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –ø–æ –≥–∞–∑—É —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ USDC —Å EIP-3009
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Å–µ—Ç—å—é Base
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–∏–ø—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ —á–∞—Ç–µ

<Card title="Worldstore Agent" icon="shopping-cart" href="https://github.com/Crossmint/worldstore-agent">
  –ê–≥–µ–Ω—Ç –¥–ª—è –ø–æ–∫—É–ø–æ–∫ —Å–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º–∏ –ø–ª–∞—Ç–µ–∂–∞–º–∏ x402 –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é –∫–æ–º–º–µ—Ä—Ü–∏–∏
</Card>

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ UX –ø–ª–∞—Ç–µ–∂–µ–π

<Tip>
–í—Å–µ–≥–¥–∞ –∏–Ω—Ñ–æ—Ä–º–∏—Ä—É–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è—Ö –∫ –æ–ø–ª–∞—Ç–µ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π. –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞—ë—Ç –¥–æ–≤–µ—Ä–∏–µ –∫ –≤–∞—à–µ–º—É –∞–≥–µ–Ω—Ç—É.
</Tip>

- **–ü–æ–Ω—è—Ç–Ω–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ** - –û—Ç–æ–±—Ä–∞–∂–∞–π—Ç–µ —Ç–æ—á–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã –∑–∞—Ä–∞–Ω–µ–µ
- **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞** - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–π—Ç–µ —É—Å–ø–µ—à–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏
- **–ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Å–±–æ–∏** - –≠–ª–µ–≥–∞–Ω—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π
- **–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —Ü–µ–Ω–Ω–æ—Å—Ç–∏** - –û–±—ä—è—Å–Ω—è–π—Ç–µ, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–ª—É—á–∞—é—Ç –∑–∞ —Å–≤–æ–π –ø–ª–∞—Ç–µ–∂

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–†–µ–∞–ª–∏–∑—É–π—Ç–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:

```typescript
async function robustPaymentHandler(ctx: any, endpoint: string) {
  try {
    const response = await fetch(endpoint);
    
    if (response.status === 402) {
      const paymentDetails = await response.json();
      
      // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –ø–ª–∞—Ç–µ–∂–∞
      if (!paymentDetails.amount || !paymentDetails.recipient) {
        await ctx.sendText("‚ùå Invalid payment request from service.");
        return;
      }
      
      // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Ä–∞–∑—É–º–Ω–∞ –ª–∏ —Å—É–º–º–∞
      if (parseFloat(paymentDetails.amount) > 1.0) {
        await ctx.sendText(`‚ö†Ô∏è High payment amount: ${paymentDetails.amount} USDC. Skipping for safety.`);
        return;
      }
      
      // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–ª–∞—Ç–µ–∂ —Å —Ç–∞–π–º–∞—É—Ç–æ–º
      const paymentPromise = facilitator.createPayment({
        amount: paymentDetails.amount,
        recipient: paymentDetails.recipient,
        reference: paymentDetails.reference,
        currency: 'USDC'
      });
      const timeoutPromise = new Promise((_, reject) => 
        setTimeout(() => reject(new Error('Payment timeout')), 30000)
      );
      
      const payment = await Promise.race([paymentPromise, timeoutPromise]);
      
      // –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Å –ø–ª–∞—Ç–µ–∂–æ–º
      const retryResponse = await fetch(endpoint, {
        headers: { "X-PAYMENT": payment.payload }
      });
      
      if (retryResponse.ok) {
        const data = await retryResponse.json();
        await ctx.sendText(`‚úÖ Payment successful! ${JSON.stringify(data)}`);
      } else {
        await ctx.sendText("‚ùå Payment processed but service unavailable.");
      }
    }
  } catch (error) {
    if (error.message.includes('timeout')) {
      await ctx.sendText("‚è±Ô∏è Payment timed out. Please try again.");
    } else if (error.message.includes('insufficient funds')) {
      await ctx.sendText("üí∏ Insufficient funds for payment.");
    } else {
      await ctx.sendText(`‚ùå Payment error: ${error.message}`);
    }
  }
}
```

### –°–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

<Warning>
–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏ –≤ –≤–∞—à–µ–º –∫–æ–¥–µ. –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–ª—é—á–∞–º–∏.
</Warning>

- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞–º–∏** - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **–õ–∏–º–∏—Ç—ã –ø–ª–∞—Ç–µ–∂–µ–π** - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –ø–æ—Ä–æ–≥–∏ –ø–ª–∞—Ç–µ–∂–µ–π
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã** - –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–π—Ç–µ –∞—Ç–∞–∫–∏ —Å–ø–∞–º–æ–º –ø–ª–∞—Ç–µ–∂–µ–π
- **–ê—É–¥–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** - –õ–æ–≥–∏—Ä—É–π—Ç–µ –≤—Å–µ –ø–ª–∞—Ç–µ–∂–Ω—ã–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è —Å–µ—Ç–∏** - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ

## –†–µ—Å—É—Ä—Å—ã

<CardGroup cols={2}>
<Card title="–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ x402" icon="book" href="https://docs.cdp.coinbase.com/x402/welcome">
  –ü–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ x402 –∏ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
</Card>

<Card title="x402.org" icon="globe" href="https://www.x402.org">
  –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ x402 —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏
</Card>

<Card title="Coinbase SDK" icon="code" href="https://github.com/coinbase/x402-sdk">
  –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π SDK x402 –æ—Ç Coinbase –¥–ª—è JavaScript/TypeScript
</Card>

<Card title="–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è XMTP" icon="message-circle" href="https://docs.xmtp.org">
  –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ XMTP –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
</Card>
</CardGroup>

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ì–æ—Ç–æ–≤—ã —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–µ–≥–æ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞? –í–æ—Ç –≤–∞—à–∞ –¥–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞:

<Steps>
<Step title="–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å—Ä–µ–¥—É —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏">
  –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ SDK x402 –∏ SDK –∞–≥–µ–Ω—Ç–∞ XMTP:
  ```bash
  npm i @xmtp/agent-sdk @coinbase/x402-sdk
  ```
</Step>

<Step title="–†–µ–∞–ª–∏–∑—É–π—Ç–µ –±–∞–∑–æ–≤–æ–≥–æ –∞–≥–µ–Ω—Ç–∞">
  –ù–∞—á–Ω–∏—Ç–µ —Å –ø—Ä–æ—Å—Ç–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ XMTP, —Å–ª–µ–¥—É—è –Ω–∞—à–µ–º—É [—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤—É –ø–æ –Ω–∞—á–∞–ª—É —Ä–∞–±–æ—Ç—ã](/base-app/agents/getting-started).
</Step>

<Step title="–î–æ–±–∞–≤—å—Ç–µ –ø–ª–∞—Ç–µ–∂–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å">
  –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–ª–∞—Ç–µ–∂–µ–π x402, –∏—Å–ø–æ–ª—å–∑—É—è –ø—Ä–∏–º–µ—Ä—ã –≤—ã—à–µ.
</Step>

<Step title="–¢—â–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ">
  –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–ª–∞—Ç–µ–∂–Ω—ã–µ –ø–æ—Ç–æ–∫–∏ –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å–µ—Ç–∏ –ø–µ—Ä–µ–¥ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ–º –≤ –ø—Ä–æ–¥–∞–∫—à–Ω.
</Step>

<Step title="–†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ">
  –†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ —Å–≤–æ–µ–≥–æ –∞–≥–µ–Ω—Ç–∞ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –ø–ª–∞—Ç–µ–∂–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
</Step>
</Steps>

–ë—É–¥—É—â–µ–µ –∞–≤—Ç–æ–Ω–æ–º–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ —É–∂–µ –∑–¥–µ—Å—å. –° –ø–æ–º–æ—â—å—é x402 –∏ XMTP –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∞–≥–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –≤ —Ü–∏—Ñ—Ä–æ–≤–æ–π —ç–∫–æ–Ω–æ–º–∏–∫–µ.
