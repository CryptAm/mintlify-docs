---
title: Использование газа в транзакциях Ethereum
description: Обзор того, как работает газ в Ethereum
---

В этой статье мы углубимся в концепцию газа и его важность в экосистеме Ethereum. Вы узнаете, почему Ethereum полагается на систему газа для регулирования выполнения транзакций и смарт-контрактов, и как она играет решающую роль в правильном функционировании сети.

---

## Цели

К концу этого урока вы сможете:

- Объяснить, что такое газ в Ethereum
- Объяснить, почему газ необходим в Ethereum
- Понимать, как работает газ в транзакциях Ethereum

---

## Что такое газ?

Газ - это термин, используемый в Ethereum для описания вычислительной единицы, которая измеряет количество вычислительной работы, необходимой для выполнения определенных операций в сети. В отличие от Bitcoin, где комиссии за транзакции учитывают только размер транзакции, Ethereum учитывает каждый вычислительный шаг, выполняемый транзакциями и выполнением кода смарт-контракта. Другими словами, каждая операция, выполняемая в Ethereum, требует определенного количества газа.

### Сложность

Количество газа, необходимое для операции, зависит от ее сложности. Более сложные операции требуют больше вычислительных ресурсов и, следовательно, требуют больше газа для выполнения. Например, простая транзакция, связанная с отправкой ETH с одного адреса на другой, может требовать меньше газа, чем сложный смарт-контракт, выполняющий несколько операций или взаимодействующий с несколькими другими контрактами.

### Состояние сети

Стоимость газа также может варьироваться в зависимости от состояния сети или, более конкретно, от того, насколько она перегружена. Когда есть больше транзакций, ожидающих обработки, чем сеть может обработать, она будет расставлять приоритеты транзакций на основе цены газа, установленной пользователем, что означает, что транзакции с более высокой ценой газа с большей вероятностью будут обработаны первыми. Когда сеть перегружена, цены на газ увеличиваются, чтобы стимулировать более эффективное использование ресурсов сети, и уменьшаются, когда использование сети ниже. Этот механизм динамического ценообразования гарантирует, что сеть Ethereum остается доступной и функциональной для всех пользователей, а также стимулирует ответственное и эффективное использование ресурсов сети.

<Frame>
![Gas Costs vs Network Congestion](/images/learn/introduction-to-ethereum/gas-costs.png)
</Frame>

---

## Почему газ необходим?

### Полнота по Тьюрингу (Turing Completeness)

Как мы уже узнали, Ethereum - это платформа, полная по Тьюрингу, что означает, что любая программа, которую можно представить в коде, теоретически может быть выражена и выполнена в сети. Это открывает двери для бесчисленного множества различных типов приложений, которые можно построить, но также создает возможность того, что вредоносный или неэффективный код может засорить сеть, потенциально приводя к атакам типа «отказ в обслуживании», спаму в сети и другим проблемам.

### Предотвращение бесконечных циклов

Газ на помощь! Чтобы предотвратить случайные или намеренные бесконечные циклы в коде смарт-контракта, Ethereum требует, чтобы каждая транзакция указывала лимит газа. Лимит газа устанавливает максимальное количество газа, которое может потребить транзакция, и гарантирует, что транзакции выполняются в пределах предопределенного количества вычислительных ресурсов, предотвращая выполнение кода, который может потреблять слишком много вычислительной мощности и потенциально вызвать заморозку или сбой сети. Без газа полнота по Тьюрингу Ethereum была бы небезопасной и неэффективной.

### Автономное выполнение

Также важно отметить, что газ позволяет выполнять смарт-контракты без необходимости центрального органа для контроля их выполнения. Система газа также предоставляет механизм регулирования ресурсов, необходимых для выполнения кода этих контрактов. Другими словами, без газа было бы трудно гарантировать, что смарт-контракты могут работать автономно, справедливо и эффективно.

---

## Как работает газ?

### Обозначения в Ethereum

Прежде чем углубиться во внутреннюю работу газа, важно понять несколько наиболее распространенных обозначений, используемых в Ethereum.

#### Ether (ETH)

Ether - это родная криптовалюта сети Ethereum. Комиссии за газ оплачиваются в ETH.

#### Wei

Wei - наименьшая единица Ethereum и эквивалентна 10^-18 ETH. Он используется для представления очень малых количеств ETH, обычно цен газа и комиссий за транзакции. Чтобы понять масштаб 10^-18:

- 1 ETH = 1,000,000,000,000,000,000 wei
- 1 wei = 0.000000000000000001 ETH

#### Gwei

Gwei обычно используется для выражения цены газа. Один гвей эквивалентен одной миллиардной одного ETH или 10^-9 ETH.

- 1 ETH = 1,000,000,000 gwei
- 1 gwei = 0.000000001 ETH

### Цена газа (Gas Price)

Цена газа (Gas Price) в сети выражается в гвей, а комиссия за газ рассчитывается как произведение цены газа и количества газа, необходимого для операции. Например, если цена газа составляет 50 гвей, а операция требует 100 000 единиц газа, комиссия за газ составит 0,005 ETH (50 гвей x 100 000 газа = 0,005 ETH).

### Лимит газа (Gas Limit)

Лимит газа (Gas Limit) - это важный компонент системы газа в Ethereum. Он определяет максимальное количество газа, которое пользователь готов потратить на обработку транзакции. Этот лимит газа устанавливается отправителем транзакции и представляет верхний предел вычислительных ресурсов, которые может потребить транзакция. Виртуальная машина Ethereum (EVM) начинает вычитать количество использованного газа из лимита газа, как только начинает обрабатывать транзакцию

Рассмотрим, что Алиса хочет отправить немного ETH Бобу. Алиса указывает лимит газа в 100 000 единиц и цену газа 10 гвей (0,00000001 ETH) за единицу газа. Таким образом, она готова потратить максимум 0,001 ETH за эту транзакцию (1 000 000 гвей).

EVM, получив транзакцию Алисы, начинает ее выполнение. По мере обработки транзакции EVM вычитает использованный газ из лимита газа. Если транзакция завершается до достижения лимита газа, оставшийся неиспользованный газ возвращается на счет Алисы.

Давайте проиллюстрируем это парой сценариев:

- Предположим, транзакция использовала 80 000 единиц газа, оставив 20 000 единиц неиспользованными. Поскольку цена газа была установлена на уровне 10 гвей за единицу, Алиса получит возврат 0,0002 ETH (200 000 гвей) за неиспользованный газ.

- В другом сценарии предположим, что Алиса отправляет транзакцию с лимитом газа 100 000 единиц. После обработки всех опкодов в транзакции, кроме последнего, транзакция Алисы потребила 99 998 единиц газа. EVM проверяет и видит, что последний опкод начнется, потому что осталось 2 единицы газа, достаточно, чтобы его запустить. Однако по мере выполнения опкода становится ясно, что ему на самом деле требуется больше 2 единиц газа. В этот момент EVM выбрасывает исключение «Недостаточно газа» (Out of Gas) и останавливает транзакцию. В этом сценарии Алиса теряет все 100 000 единиц газа, так как они потребляются в попытке выполнения. Все изменения состояния, которые могли произойти во время выполнения, откатываются, и ETH, который Алиса пыталась отправить Бобу, возвращается ей.

### Оценка газа (Gas Estimation)

Оценка газа (Gas estimation) - еще одно ключевое понятие, которое нужно понять. Оно относится к процессу прогнозирования количества газа, которое потребуется для выполнения транзакции. Это важно, потому что, как мы видели в нашем примере, лимит газа для транзакции должен быть установлен до того, как она может быть отправлена в сеть. Если лимит газа установлен слишком низко, транзакция может не выполниться, а если он установлен слишком высоко, отправитель может в конечном итоге заплатить больше комиссий за транзакцию, чем необходимо.

Существует несколько методов, которые можно использовать для оценки газа. Один распространенный метод - использовать исторические цены газа и лимиты газа в качестве точки отсчета и оценивать газ, необходимый для новой транзакции, на основе газа, использованного в похожих прошлых транзакциях. Другой метод — симулировать выполнение транзакции в тестовой среде, чтобы определить фактическое количество газа, которое будет использовано.

К счастью, большинство приложений кошельков Ethereum имеют встроенные алгоритмы оценки газа, которые могут автоматически рассчитывать подходящий лимит газа для транзакции на основе условий сети в момент инициирования транзакции. Это помогает предотвратить сбой транзакции из-за слишком низкого лимита газа, одновременно оптимизируя для наилучшей возможной стоимости для отправителя.

---

## Заключение

Газ (Gas) - жизненно важный компонент Ethereum. Он регулирует выполнение всех транзакций и смарт-контрактов и играет значительную роль в правильном функционировании и безопасности сети. Без газа архитектура Ethereum, полная по Тьюрингу, была бы неэффективной и уязвимой для атак. Газ также гарантирует, что смарт-контракты могут работать автономно, справедливо и эффективно без необходимости центрального органа для контроля их выполнения. Понимание того, как работает газ, необходимо для всех, кто хочет разрабатывать приложения или смарт-контракты в сети Ethereum.



---

## Смотрите также

- [Gas and Fees (Ethereum Docs)](https://ethereum.org/en/developers/docs/gas/)
- [Transaction Gas (Mastering Ethereum)](https://github.com/ethereumbook/ethereumbook/blob/develop/06transactions.asciidoc#transaction-gas)
- [Turing Completeness and Gas (Mastering Ethereum)](https://github.com/ethereumbook/ethereumbook/blob/develop/13evm.asciidoc#turing-completeness-and-gas)
- [Gas (Mastering Ethereum)](https://github.com/ethereumbook/ethereumbook/blob/develop/13evm.asciidoc#gas)
