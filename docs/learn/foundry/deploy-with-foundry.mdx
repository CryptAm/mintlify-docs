---
title: Deploying a smart contract using Foundry
slug: /deploy-with-foundry
description: "A tutorial that teaches how to deploy a smart contract on the Base test network using Foundry. Includes instructions for setting up the environment, compiling, and deploying the smart contract."
author: neodaoist
---

# Развертывание смарт-контракта с использованием Foundry

В этой статье представлен обзор набора инструментов разработки [Foundry](https://book.getfoundry.sh/) и показано, как развернуть контракт в тестовой сети **Base Sepolia**.

Foundry - это мощный набор инструментов для разработки, тестирования и отладки ваших смарт-контрактов. Он включает несколько отдельных инструментов:

- `forge`: основная рабочая лошадка Foundry - для разработки, тестирования, компиляции и развертывания смарт-контрактов
- `cast`: инструмент командной строки для выполнения вызовов Ethereum RPC (например, взаимодействия с контрактами, отправки транзакций и получения данных из блокчейна)
- `anvil`: локальный узел тестовой сети для тестирования поведения контракта из фронтенда или через RPC
- `chisel`: [REPL](https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop) для Solidity, для экспериментов с фрагментами кода Solidity в локальной или форкнутой сети

Foundry предлагает чрезвычайно быстрые циклы обратной связи (благодаря реализации на Rust) и меньшее переключение контекста - потому что вы будете писать свои контракты, тесты и скрипты развертывания **все** на Solidity!

<Info>
Для развертывания в рабочую/основную сеть (mainnet) шаги ниже в этом руководстве будут почти идентичными, однако вам нужно будет убедиться, что вы настроили `Base` (mainnet) как сеть, а не `Base Sepolia` (testnet).
</Info>

## Цели обучения

После изучения этого руководства вы сможете сделать следующее:

- Настроить Foundry для Base
- Создать NFT смарт-контракт для Base
- Скомпилировать смарт-контракт для Base (используя `forge`)
- Развернуть смарт-контракт в Base (также с помощью `forge`)
- Взаимодействовать со смарт-контрактом, развернутым в Base (используя `cast`)

## Предварительные требования

### Foundry

Для этого руководства требуется установленный Foundry.

- В командной строке (терминале) выполните: `curl -L https://foundry.paradigm.xyz | bash`
- Затем выполните `foundryup`, чтобы установить последнюю (ночную) сборку Foundry

Для получения дополнительной информации смотрите [руководство по установке](https://book.getfoundry.sh/getting-started/installation) в книге Foundry.

### Coinbase Wallet

Чтобы развернуть смарт-контракт, вам сначала понадобится web3 кошелек. Вы можете создать кошелек, загрузив расширение для браузера Coinbase Wallet.

- Скачайте [Coinbase Wallet](https://chrome.google.com/webstore/detail/coinbase-wallet-extension/hnfanknocfeofbddgcijnmhnfnkdnaad?hl=en)

### Средства в кошельке

Развертывание контрактов в блокчейне требует оплаты комиссии за газ. Поэтому вам нужно будет пополнить свой кошелек ETH для покрытия этих комиссий.

Для этого руководства вы будете развертывать контракт в тестовой сети Base Sepolia. Вы можете пополнить свой кошелек Base Sepolia ETH, используя один из кранов, перечисленных на странице [Network Faucets](https://docs.base.org/base-chain/tools/network-faucets) Base.

## Создание проекта

Прежде чем начать развертывать смарт-контракты в Base, вам нужно настроить среду разработки, создав проект Foundry.

Чтобы создать новый проект Foundry, сначала создайте новую директорию:

```bash
mkdir myproject
```

Затем выполните:

```bash
cd myproject
forge init
```

Это создаст проект Foundry со следующей базовой структурой:

```bash
.
├── foundry.toml
├── script
 │   └── Counter.s.sol
├── src
 │   └── Counter.sol
└── test
    └── Counter.t.sol
```

## Компиляция смарт-контракта

Ниже приведен простой NFT смарт-контракт ([ERC-721](https://eips.ethereum.org/EIPS/eip-721)) написанный на языке программирования Solidity:

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.23;

import "openzeppelin-contracts/contracts/token/ERC721/ERC721.sol";

contract NFT is ERC721 {
    uint256 public currentTokenId;

    constructor() ERC721("NFT Name", "NFT") {}

    function mint(address recipient) public payable returns (uint256) {
        uint256 newItemId = ++currentTokenId;
        _safeMint(recipient, newItemId);
        return newItemId;
    }
}
```

Код Solidity выше определяет смарт-контракт с именем `NFT`. Код использует интерфейс `ERC721`, предоставленный библиотекой [OpenZeppelin Contracts library](https://docs.openzeppelin.com/contracts/5.x/), для создания NFT смарт-контракта. OpenZeppelin позволяет разработчикам использовать проверенные в боях реализации смарт-контрактов, соответствующие официальным стандартам ERC.

Чтобы добавить библиотеку OpenZeppelin Contracts в ваш проект, выполните:

```bash
forge install openzeppelin/openzeppelin-contracts
```

В вашем проекте удалите контракт `src/Counter.sol`, который был сгенерирован с проектом, и добавьте приведенный выше код в новый файл с именем `src/NFT.sol`. (Вы также можете удалить файлы `test/Counter.t.sol` и `script/Counter.s.sol`, но вам следует добавить свои собственные тесты как можно скорее!).

Чтобы скомпилировать наш базовый NFT контракт с использованием Foundry, выполните:

```bash
forge build
```

## Настройка Foundry для работы с Base

Далее вы настроите свой проект Foundry для развертывания смарт-контрактов в сеть Base. Сначала вы сохраните свой приватный ключ в зашифрованном хранилище ключей, затем добавите Base как сеть.

### Хранение вашего приватного ключа

Следующая команда импортирует ваш приватный ключ в безопасное хранилище ключей Foundry. Вам будет предложено ввести ваш приватный ключ, а также пароль для подписания транзакций:

```bash
cast wallet import deployer --interactive
```

<Caution>
Инструкции о том, как получить ваш приватный ключ из Coinbase Wallet, смотрите в [документации Coinbase Wallet](https://docs.cloud.coinbase.com/wallet-sdk/docs/developer-settings#show-private-key). **Крайне важно НЕ коммитить это в публичный репозиторий**.
</Caution>

Выполните эту команду, чтобы подтвердить, что учетная запись 'deployer' настроена в Foundry:

```bash
cast wallet list
```

### Добавление Base как сети

При проверке контракта с помощью BaseScan вам нужен API-ключ. Вы можете получить свой API-ключ BaseScan [отсюда](https://basescan.org/myapikey) после регистрации учетной записи.

<Caution>
Хотя они сделаны одними и теми же людьми, API-ключи Etherscan **не будут** работать на BaseScan!
</Caution>

Теперь создайте файл `.env` в домашней директории вашего проекта, чтобы добавить сеть Base и API-ключ для проверки вашего контракта на BaseScan:

```
BASE_MAINNET_RPC="https://mainnet.base.org"
BASE_SEPOLIA_RPC="https://sepolia.base.org"
ETHERSCAN_API_KEY="<YOUR API KEY>"
```

Обратите внимание, что даже если вы используете BaseScan как ваш обозреватель блоков, Foundry ожидает, что API-ключ будет определен как `ETHERSCAN_API_KEY`.

### Загрузка переменных окружения

Теперь, когда вы создали файл `.env`, выполните следующую команду, чтобы загрузить переменные окружения в текущую сессию командной строки:

```bash
source .env
```

## Развертывание смарт-контракта

Теперь, когда ваш контракт скомпилирован и среда настроена, вы готовы развернуть в тестовой сети Base Sepolia!

Сегодня вы будете использовать команду `forge create`, которая является простым способом развертывания одного контракта за раз. В будущем вы можете захотеть изучить [`forge script`](https://book.getfoundry.sh/guides/scripting-with-solidity), который позволяет создавать скрипты для ончейн транзакций и развертывать более сложные проекты смарт-контрактов.

Вам понадобится тестовый ETH в вашем кошельке. Смотрите [предварительные требования](#prerequisites) если вы еще этого не сделали. В противном случае попытка развертывания завершится неудачей.

Чтобы развернуть контракт в тестовой сети Base Sepolia, выполните следующую команду. Вам будет предложено ввести пароль, который вы установили ранее, при импорте приватного ключа:

```bash
forge create ./src/NFT.sol:NFT --rpc-url $BASE_SEPOLIA_RPC --account deployer
```

Контракт будет развернут в тестовой сети Base Sepolia. Вы можете просмотреть статус развертывания и контракт с помощью [обозревателя блоков](/base-chain/tools/block-explorers) выполнив поиск по адресу, возвращенному вашим скриптом развертывания. Если вы развернули точную копию NFT контракта выше, он уже будет проверен, и вы сможете читать и записывать в контракт с помощью веб-интерфейса.

<Info>
Если вы хотите развернуть в основную сеть (mainnet), вы измените команду следующим образом:
</Info>

```bash
forge create ./src/NFT.sol:NFT --rpc-url $BASE_MAINNET_RPC --account deployer
```

Независимо от сети, в которую вы развертываете, если вы развертываете новый или измененный контракт, вам нужно будет его проверить.

## Проверка смарт-контракта

В web3 считается лучшей практикой проверять ваши контракты, чтобы пользователи и другие разработчики могли проверить исходный код и убедиться, что он соответствует развернутому байткоду в блокчейне.

Кроме того, если вы хотите позволить другим взаимодействовать с вашим контрактом с помощью обозревателя блоков, его сначала необходимо проверить. Вышеуказанный контракт уже проверен, поэтому вы уже должны увидеть свою версию в обозревателе блоков, но мы все равно пройдемся по процессу проверки контракта в тестовой сети Base Sepolia.

<Info>
Помните, вам нужен API-ключ от BaseScan для проверки ваших контрактов. Вы можете получить свой API-ключ на [сайте BaseScan](https://basescan.org/myapikey) после регистрации учетной записи.
</Info>

Возьмите развернутый адрес и выполните:

```bash
forge verify-contract <DEPLOYED_ADDRESS> ./src/NFT.sol:NFT --chain 84532 --watch
```

Вы должны увидеть вывод, похожий на:

```
Start verifying contract `0x71bfCe1172A66c1c25A50b49156FAe45EB56E009` deployed on base-sepolia

Submitting verification for [src/NFT.sol:NFT] 0x71bfCe1172A66c1c25A50b49156FAe45EB56E009.
Submitted contract for verification:
        Response: `OK`
        GUID: `3i9rmtmtyyzkqpfvy7pcxj1wtgqyuybvscnq8d7ywfuskss1s7`
        URL:
        https://sepolia.basescan.org/address/0x71bfce1172a66c1c25a50b49156fae45eb56e009
Contract verification status:
Response: `NOTOK`
Details: `Pending in queue`
Contract verification status:
Response: `OK`
Details: `Pass - Verified`
Contract successfully verified
```

Найдите свой контракт на [BaseScan](https://sepolia.basescan.org/), чтобы подтвердить, что он проверен.

<Info>
Вы не можете повторно проверить контракт, идентичный уже проверенному. Если вы попытаетесь сделать это, например, проверить вышеуказанный контракт, вы получите ошибку, похожую на:
</Info>

```text
Start verifying contract `0x71bfCe1172A66c1c25A50b49156FAe45EB56E009` deployed on base-sepolia

Contract [src/NFT.sol:NFT] "0x71bfCe1172A66c1c25A50b49156FAe45EB56E009" is already verified. Skipping verification.
```

## Взаимодействие со смарт-контрактом

Если вы проверили на BaseScan, вы можете использовать разделы `Read Contract` и `Write Contract` на вкладке `Contract` для взаимодействия с развернутым контрактом. Чтобы использовать `Write Contract`, вам сначала нужно подключить ваш кошелек, нажав кнопку `Connect to Web3` (иногда это может быть немного капризным, и вам нужно нажать `Connect` дважды, прежде чем он покажет, что ваш кошелек успешно подключен).

Чтобы попрактиковаться в использовании инструмента командной строки `cast`, который предоставляет Foundry, вы выполните вызов без публикации транзакции (чтение), затем подпишете и опубликуете транзакцию (запись).

### Выполнение вызова

Ключевой компонент набора инструментов Foundry, `cast` позволяет нам взаимодействовать с контрактами, отправлять транзакции и получать данные из блокчейна с помощью вызовов Ethereum RPC. Сначала вы выполните вызов со своего аккаунта без публикации транзакции.

Из командной строки выполните:

```bash
cast call <DEPLOYED_ADDRESS> --rpc-url $BASE_SEPOLIA_RPC "balanceOf(address)" <YOUR_ADDRESS_HERE>
```

Вы должны получить `0x0000000000000000000000000000000000000000000000000000000000000000` в ответе, что равно `0` в шестнадцатеричной системе. И это логично - пока вы развернули NFT контракт, никакие NFT еще не были созданы (cминчены), поэтому баланс вашего аккаунта равен нулю.

### Подписание и публикация транзакции

Теперь подпишите и опубликуйте транзакцию, вызвав функцию `mint(address)` в NFT контракте, который вы только что развернули.

Выполните следующую команду:

```bash
cast send <DEPLOYED_ADDRESS> --rpc-url=$BASE_SEPOLIA_RPC "mint(address)" <YOUR_ADDRESS_HERE> --account deployer
```

<Info>
Обратите внимание, что в команде `cast send` вам нужно было включить ваш приватный ключ, но это не требуется для `cast call`, потому что это для вызова функций контракта только для чтения, и поэтому вам не нужно ничего подписывать.
</Info>

В случае успеха Foundry ответит информацией о транзакции, включая `blockNumber`, `gasUsed` и `transactionHash`.

Наконец, давайте подтвердим, что вы действительно создали (сминтили) себе один NFT. Если вы снова запустите первую команду `cast call`, вы должны увидеть, что ваш баланс увеличился с 0 до 1:

```bash
cast call <DEPLOYED_ADDRESS> --rpc-url $BASE_SEPOLIA_RPC "balanceOf(address)" <YOUR_ADDRESS_HERE>
```

И ответ: `0x0000000000000000000000000000000000000000000000000000000000000001` (`1` in hex) — поздравляем, вы развернули контракт и создали NFT с помощью Foundry!

## Заключение

Фух, это было много! Вы узнали, как настроить проект, развернуть в Base и взаимодействовать с нашим смарт-контрактом с помощью Foundry. Процесс такой же для реальных сетей, просто дороже - и, конечно, вы захотите инвестировать время и усилия в тестирование ваших контрактов, чтобы снизить вероятность ошибок, влияющих на пользователей, перед развертыванием.

По всем вопросам, связанным с Foundry, обратитесь к [книге Foundry](https://book.getfoundry.sh/), или перейдите в официальный Telegram [чат разработчиков](https://t.me/foundry_rs) или [чат поддержки](https://t.me/foundry_support).

{/*-- Add reference style links here.  These do not render on the page. --*/}

[`sepolia.basescan.org`]: https://sepolia.basescan.org/
[`basescan.org`]: https://basescan.org/
[coinbase]: https://www.coinbase.com/wallet
[MetaMask]: https://metamask.io/
[coinbase settings]: https://docs.cloud.coinbase.com/wallet-sdk/docs/developer-settings
[etherscan]: https://etherscan.io/
[faucets on the web]: https://coinbase.com/faucets
[Foundry]: https://book.getfoundry.sh/

