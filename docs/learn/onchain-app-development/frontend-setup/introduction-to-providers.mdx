---
title: 'Введение в провайдеры'
slug: /intro-to-providers
description: Руководство, которое объясняет, что такое провайдеры, зачем они нужны, как настроить несколько провайдеров и использовать их для подключения к блокчейну.
author: briandoyle81
---

# Введение в провайдеры

Это руководство представляет введение в провайдеры и показывает, как подключить ваш фронтенд к блокчейну с использованием JSON RPC провайдеров блокчейна и стека [RainbowKit], [wagmi], и [viem].

## Цели

К концу этого руководства вы должны уметь:

- Сравнивать публичные провайдеры, провайдеры от вендоров и провайдеры кошельков
- Выбирать подходящий провайдер для различных случаев использования
- Настраивать провайдер в wagmi и использовать его для подключения кошелька
- Защищать API-ключи, которые будут раскрыты на фронтенде

## Предварительные требования

### 1. Будьте знакомы с современной фронтенд-разработкой

В этом руководстве мы будем работать с React-фронтендом, построенным на [Next.js]. Хотя вам не нужно быть экспертом, мы предполагаем, что вы знакомы с основами.

### 2. Иметь общее понимание EVM и разработки смарт-контрактов

Это руководство предполагает, что вы достаточно уверенно пишете базовые смарт-контракты. Если вы только начинаете, перейдите к нашим гайдам [Base Learn] и начинайте учиться!

## Типы провайдеров

Ончейн-приложениям нужны фронтенды, иногда называемые dApps, чтобы позволить вашим пользователям взаимодействовать с вашими смарт-контрактами. _Провайдер_ обеспечивает соединение от фронтенда к блокчейну и используется для чтения данных и отправки транзакций.

В разработке блокчейнов термин провайдер описывает компанию или сервис, который предоставляет API, обеспечивающий доступ к блокчейну как к услуге. Это отличается от провайдеров, которыми вы оборачиваете свое приложение с помощью [React Context API], хотя вы будете использовать один из них, чтобы передать ваш блокчейн-провайдер глубоко в ваше приложение.

Эти сервисы позволяют взаимодействовать со смарт-контрактами без необходимости разработчику запускать и поддерживать собственную ноду блокчейна. Запуск ноды дорог, сложен и требует усилий. В большинстве случаев вам захочется начать с провайдера. Как только вы начнете набирать популярность, вы сможете оценить необходимость [run your own node], или перейти к более продвинутому архитектурному решению, например, использованию [Subgraph].

Сначала может быть немного запутанно понять, какой тип провайдера использовать. Как и все в блокчейне, ландшафт быстро меняется, а результаты поиска часто возвращают устаревшую информацию.

<Info>
Новые ончейн-разработчики иногда получают впечатление, что существуют бесплатные варианты для подключения их приложений к блокчейну. К сожалению, это не совсем так. Данные блокчейна по-прежнему состоят из 1 и 0, извлекаемых вычислениями и передаваемых в интернет через серверы.

Содержание этих серверов стоит денег, и в конечном итоге вам придется платить за услугу.
</Info>

Вы столкнетесь с провайдерами, разделенными на три общие категории: Публичные провайдеры, Провайдеры кошельков и Провайдеры от вендоров.

### Публичные провайдеры

Многие руководства и гайды, включая руководство по началу работы с [wagmi], используют _Публичный провайдер_ по умолчанию, чтобы быстро вас запустить. "Публичный" означает, что они открыты, без разрешений и бесплатны, поэтому в руководствах также обычно предупреждают, что вам нужно добавить другой провайдер, если вы не хотите столкнуться с ограничением скорости (rate limiting). Прислушивайтесь к этим предупреждениям! Лимиты скорости публичных провайдеров строги, и вы очень быстро начнете сталкиваться с ограничениями.

В wagmi публичный клиент автоматически включен в конфигурацию по умолчанию. Этот клиент - всего лишь обертка, настраивающая провайдер [JSON RPC] с использованием `chain` и `rpcUrls`, указанных в каталоге информации о цепях Viem. Вы можете просмотреть [data for Base Sepolia here].

Большинство цепей также перечисляют эту информацию в своей документации. Например, на страницах сетевой информации для [Base] и [Optimism]. При желании вы можете вручную настроить `jsonRpcProvider` в wagmi, используя эту информацию.

### Провайдеры кошельков

Многие кошельки, включая Coinbase Wallet и MetaMask, внедряют провайдер Ethereum в браузер, как определено в [EIP-1193]. Инжектированный провайдер доступен через `window.ethereum`.

Под капотом это также просто провайдеры JSON RPC. Подобно публичным провайдерам, они имеют ограничения по скорости.

Более старые руководства для ранних библиотек, как правило, предлагали использовать этот метод для начала, поэтому вы, вероятно, встретите ссылки на него. Однако он вышел из моды, и вы захотите использовать публичный провайдер для своих начальных экспериментов с подключением.

### Провайдеры от вендоров

Растущее число поставщиков предоставляет доступ к нодам блокчейна как к услуге. Посещение целевых страниц [QuickNode], [Alchemy], или [Coinbase Developer Platform (CDP)] может быть немного запутанным. Каждый из этих поставщиков предлагает широкий спектр услуг, SDK и информации.

К счастью, вы можете пропустить большую часть этого, если просто пытаетесь подключить свой фронтенд к своим смарт-контрактам. Вам просто нужно зарегистрировать учетную запись, получить конечную точку (endpoint) или ключ и настроить свое приложение для подключения к выбранному вами провайдеру (провайдерам).

Стоит разобраться, чтобы лучше понять, как эти провайдеры взимают с вас плату за свои услуги. В таблице ниже обобщены некоторые из наиболее важных методов API и то, как каждый из вышеупомянутых провайдеров взимает плату за них.

Обратите внимание, что информация ниже может измениться и зависит от сети. Каждый провайдер также имеет разные стимулы, скидки и тарифы для каждого уровня продукта. Они также имеют разные лимиты на количество вызовов в секунду, протоколов и конечных точек. Пожалуйста, проверяйте источник для подтверждения!

|                 | [Стоимость Alchemy]  | [Стоимость QuickNode] | [Стоимость CDP]    |
| :-------------- | :------------------- | :-------------------- | :----------------- |
| Бесплатный тариф / месяц | 3M вычислительных единиц | 50M кредитов       | 500M биллинг-единиц |
| Средний тариф / месяц  | 1.5B CUs @ $199  | 3B кредитов @ $299 | Скоро             |
| eth_blocknumber | 10               | 20                | 30                 |
| eth_call        | 26               | 20                | 30                 |
| eth_getlogs     | 75               | 20                | 100                |
| eth_getbalance  | 19               | 20                | 30                 |

Чтобы дать вам представление об объемах использования: один хук wagmi `useContractRead`, настроенный на отслеживание изменений в одном `view` через TanStack query и `useBlockNumber`, будет вызывать `eth_blocknumber` и `eth_call` по одному разу каждые 4 секунды.

## Подключение к блокчейну

[RainbowKit] - популярная библиотека, которая работает с [wagmi], чтобы упростить подключение, отключение и переключение между несколькими кошельками. Она предоставляет готовые решения "из коробки" и позволяет сильно кастомизировать список кошельков и кнопку подключения/отключения.

Для этого руководства вы будете использовать [quick start] RainbowKit для создания нового проекта. Обратите внимание, что на момент написания он **не** использует App Router от Next.js. См. [Building an Onchain App], если вы хотите настроить это вместо этого.

<Info>
Скрипт не позволяет использовать `.` для создания проекта в корне папки, из которой вы его запускаете, поэтому вам нужно запустить его из вашей директории `src` или откуда вы храните папки проектов.

Он создаст папку с указанным вами именем проекта и создаст файлы внутри.
</Info>

Откройте терминал и выполните:

```bash
yarn create @rainbow-me/rainbowkit
```

Дайте вашему проекту имя и подождите, пока скрипт соберет его. Это займет минуту или две.

<Warning>
Если вы получите ошибку из-за неправильной версии Node, переключитесь на правильную версию, затем **удалите все** и снова запустите скрипт.
</Warning>

### Сгенерированное приложение

Откройте ваш новый проект в предпочитаемом редакторе и откройте `pages/_app.tsx`. Здесь вы найдете знакомое приложение Next.js, обернутое в [context providers] для TanStack QueryProvider, RainbowKit и wagmi.

```tsx
function MyApp({ Component, pageProps }: AppProps) {
  return (
    <WagmiProvider config={config}>
      <QueryClientProvider client={client}>
        <RainbowKitProvider>
          <Component {...pageProps} />
        </RainbowKitProvider>
      </QueryClientProvider>
    </WagmiProvider>
  );
}
```

Обратите внимание, что эти провайдеры используют функцию контекста React для передачи провайдеров блокчейна и конфигурации в ваше приложение. Может сбивать с толку, что слово _провайдер_ означает две разные вещи в одном файле или даже в одной строке кода!

Прежде чем вы сможете сделать что-либо еще, вам необходимо получить `projectId` от _WalletConnect_.

Откройте home страницу [WalletConnect], создайте учетную запись и/или войдите в систему выбранным вами способом.

Нажмите кнопку `Create` в правом верхнем углу вкладки `Projects`.

![Create Button](/images/connecting-to-the-blockchain/wallet-connect-create-button.png)

Введите имя для вашего проекта, выберите опцию App и нажмите Create.

![Project Information](/images/connecting-to-the-blockchain/add-project-information.png)

Скопируйте Project ID со страницы информации о проекте и вставьте его в качестве `projectId` в `getDefaultWallets`.

```tsx
const { connectors } = getDefaultWallets({
  appName: 'RainbowKit App',
  projectId: 'YOUR_PROJECT_ID',
  chains,
});
```

<Warning>
Помните, все, что вы размещаете на фронтенде, является публичным! Это включает и этот идентификатор, даже если вы используете переменные окружения для лучшего управления такого типа данными. Next.js напоминает вам о риске, требуя добавлять префикс `NEXT_PUBLIC_` к любым переменным окружения, которые могут быть прочитаны браузером.

Прежде чем развертывать, убедитесь, что вы настроили остальные элементы в панели управления, чтобы гарантировать, что только ваш сайт может использовать этот идентификатор.
</Warning>

### Публичный провайдер

По умолчанию скрипт установки настроит ваше приложение на использование встроенного публичного провайдера и подключение к ряду популярных цепей. Для упрощения удалите все, кроме `mainnet` и `base`.

```tsx
const config = getDefaultConfig({
  appName: 'RainbowKit App',
  projectId: 'YOUR_APP_ID_HERE',
  chains: [mainnet, base],
  ssr: true,
});
```

Откройте терминал и запустите приложение:

```bash
yarn run dev
```

Нажмите кнопку `Connect Wallet`, выберите ваш кошелек в модальном окне, подтвердите подключение, и вы должны увидеть вашу сеть, баланс токенов и адрес или ENS-имя в верхней части экрана. Выберите ваш кошелек из модального окна.

![RainbowKit modal](/images/connecting-to-the-blockchain/rainbowkit-modal.png)

Вы подключились с помощью Публичного провайдера!

![Connected](/images/connecting-to-the-blockchain/connected.png)

### QuickNode

Чтобы выбрать ваши провайдеры, вы будете использовать [`createConfig`] вместо `getDefaultConfig`. Свойство [`transports`] позволяет настроить, как вы хотите подключаться к нескольким сетям. Если вам нужно больше одного коннектора для данной сети, вы можете использовать [`fallbacks`].

Сначала настройте использование [QuickNode] в качестве вашего провайдера. Замените ваш импорт конфигурации по умолчанию из RainbowKit на `createConfig` и `http` из wagmi:

```tsx
import { createConfig, http, WagmiProvider } from 'wagmi';
// ...Импорт Chains
import { RainbowKitProvider } from '@rainbow-me/rainbowkit';
```

Вам понадобится RPC URL, поэтому откройте сайт [QuickNode] и зарегистрируйте учетную запись, если нужно. Бесплатного тарифа будет достаточно для начала, вам может потребоваться прокрутить вниз, чтобы увидеть его. После входа нажмите `Endpoints` на левой панели, затем нажмите `+ Create Endpoint`.

На следующем экране вам будет предложено выбрать цепь. Каждая конечная точка работает только для одной. Выберите `Base`, нажмите `Continue`.

![Select Chain](/images/connecting-to-the-blockchain/quicknode-select-chain.png)

Пока выберите `Base Mainnet`, но, вероятно, вы захотите удалить эту конечную точку и создать новую для Sepolia, когда начнете разрабатывать. Бесплатный тариф позволяет иметь только одну конечную точку одновременно.

Если вы еще не выбрали тариф, вам будет предложено это сделать, затем вы попадете на страницу конечных точек, где будут отображены ваши конечные точки для HTTP и WSS.

<Warning>
Как и в случае с вашим идентификатором WalletConnect, эти конечные точки будут видны на фронтенде. Обязательно настройте разрешенный список (allowlist)!
</Warning>

Используйте эту конечную точку, чтобы добавить `transport` типа `http` в вашу конфигурацию:

```tsx
const config = createConfig({
  chains: [mainnet, base],
  ssr: true,
  transports: {
    [base.id]: http('YOUR PROJECT URL'),
    [mainnet.id]: http('TODO'),
  },
});
```

Теперь приложение будет использовать вашу конечную точку QuickNode для сети Base. Обратите внимание, что вам не нужно имя приложения или идентификатор WalletConnect, потому что вы больше не используете WalletConnect.

Чтобы протестировать это, несколько раз переключите сети. Вы поймете, что все работает, если увидите ваш баланс, когда выбрана сеть Base. Вы не добавили mainnet, поэтому при переключении на нее в консоли будет ошибка и баланс отображаться не будет.

### Alchemy

[Alchemy] is [no longer baked into wagmi], но он по-прежнему работает так же, как и любой другой RPC-провайдер. Как и в случае с QuickNode, вам понадобится учетная запись и ключ. Создайте учетную запись и/или войдите, перейдите в раздел `Apps` в левой боковой панели и нажмите `Create new app`.

![Alchemy new app](/images/connecting-to-the-blockchain/alchemy-new-app.png)

Выберите Base Mainnet и дайте вашему приложению имя.

<Warning>
Once again, remember to configure the [allowlist] when you publish your app, as you'll be exposing your key to the world!
</Warning>
