---
title: Абстракция аккаунтов на Base с использованием Biconomy
slug: /account-abstraction-with-biconomy
description: Руководство, которое учит, как реализовать абстракцию аккаунтов в проект Base с использованием paymasters, bundlers и умных аккаунтов от Biconomy.
author: taycaldwell
---

# Абстракция аккаунтов на Base с использованием Biconomy

На этой странице вы узнаете, как реализовать абстракцию аккаунтов (Account Abstraction) в ваших проектах на Base, используя paymasters, bundlers и умные аккаунты (smart accounts) от Biconomy.

## Цели

К концу этого руководства вы сможете:

- Настроить проект смарт-контракта для Base с использованием [Foundry](https://book.getfoundry.sh/)
- Настроить фронтенд-проект на Next.js с помощью `create next-app`
- Настроить вход пользователей и аутентификацию с использованием [Particle Network](https://particle.network/)
- Настроить [Biconomy](https://biconomy.io/) paymaster and bundler
- Создать транзакцию без оплаты газа (gasless transaction)

## Предварительные требования

### Foundry

Для этого руководства требуется установленный Foundry.

- В командной строке (терминале) выполните: `curl -L https://foundry.paradigm.xyz | bash`
- Затем выполните foundryup, чтобы установить последнюю (ночную) сборку Foundry

Для получения дополнительной информации см. [руководство по установке](https://book.getfoundry.sh/getting-started/installation) в документации Foundry.

### Coinbase Wallet

Для этого учебника требуется наличие кошелька. Вы можете создать кошелек, скачав браузерное расширение Coinbase Wallet:

- Скачайте [Coinbase Wallet](https://chrome.google.com/webstore/detail/coinbase-wallet-extension/hnfanknocfeofbddgcijnmhnfnkdnaad?hl=en)

### Средства в кошельке

Для завершения этого учебника вам нужно пополнить кошелек ETH в сети Base Goerli.

ETH требуется для покрытия комиссий за газ (gas fees), связанных с развертыванием смарт-контрактов в сети.

- Чтобы пополнить ваш кошель ETH в сети Base Goerli, посетите один из кранов (faucets), перечисленных на странице [краны Base](https://docs.base.org/base-chain/tools/network-faucets).

## Что такое Biconomy?

Biconomy - это набор инструментов, который предлагает комплексное решение для абстракции аккаунтов, включая смарт-аккаунты (smart accounts), paymasters для спонсирования комиссий за газ и bundlers для объединения пользовательских операций (user operations) в одну транзакцию.

### Высокоуровневые концепции

#### Абстракция аккаунтов (Account Abstraction)

Абстракция аккаунтов ([ERC-4337](https://eips.ethereum.org/EIPS/eip-4337)) позволяет пользователям использовать умные контрактные кошельки (smart contract wallets) вместо традиционных кошельков, управляемых извне (Externally Owned Account, EOA).

#### Смарт-аккаунты

Смарт-аккаунт (также известный как умный контрактный кошелек) — это кошелек, который хранит и управляет цифровыми активами (токены ERC-20, NFT и т.д.) с помощью смарт-контракта.

#### Пользовательские операции

Пользовательская операция (user operation) - это псевдотранзакционный объект, отправляемый умным аккаунтом, который описывает транзакцию для отправки. Несколько пользовательских операций в конечном итоге объединяются (bundled) и инициируются как одна реальная транзакция с помощью bundler.

#### Paymaster

A paymaster - это специальный смарт-контракт, который позволяет приложениям «спонсировать пользовательские операции», то есть оплачивать комиссии за газ, связанные с результирующей транзакцией.

#### Bundler

Специальный узел (node), который отслеживает мемпул (mempool) пользовательских операций и объединяет несколько пользовательских операций в одну транзакцию.

<Info>
Paymaster от Biconomy - это сервис, который позволяет вам спонсировать комиссии за газ для ваших пользователей, позволяя осуществлять транзакции без оплаты газа (gasless transactions). Узнайте больше в [документации Biconomy](https://docs.biconomy.io/).
</Info>

## Создание и развертывание смарт-контракта

Прежде чем начать, вам необходимо настроить среду разработки смарт-контрактов с использованием Foundry.

Чтобы создать новый проект, сначала создайте новую директорию с именем `myproject` и перейдите в нее:

```bash
mkdir myproject
cd myproject
```

### Создание проекта Foundry

Затем в директории `myproject` создайте новую директорию с именем contracts и перейдите в нее:

```bash
mkdir contracts
cd contracts
```

Затем создайте новый проект Foundry, выполнив следующую команду:

```bash
forge init
```

Это создаст проект Foundry со следующей базовой структурой:

```bash
.
├── foundry.toml
├── script
├── src
└── test
```

<Info>
Команда создает шаблонный файл смарт-контракта Solidity под названием `src/Counter.sol`. Это основной контракт, который вы будете использовать в этом учебнике.
</Info>

### Компиляция смарт-контракта

Скомпилируйте смарт-контракт, чтобы убедиться, что он собирается без ошибок.

Чтобы скомпилировать ваш смарт-контракт, выполните:

```bash
forge build
```

### Настройка кошелька как развертывающего аккаунта (deployer)

Прежде чем вы сможете развернуть свой смарт-контракт в различных сетях, вам нужно настроить кошелек, который будет использоваться в качестве развертывающего аккаунта (deployer).

Для этого вы можете использовать команду [`cast wallet import`](https://book.getfoundry.sh/reference/cast/cast-wallet-import) чтобы импортировать приватный ключ кошелька в безопасно зашифрованное хранилище ключей Foundry:

```bash
cast wallet import deployer --interactive
```

После выполнения команды выше вам будет предложено ввести ваш приватный ключ, а также пароль для подписания транзакций.

<Warning>
Инструкции о том, как получить приватный ключ из Coinbase Wallet, можно найти в [документации Coinbase Wallet](https://docs.cloud.coinbase.com/wallet-sdk/docs/developer-settings#show-private-key). **Крайне важно НЕ коммитить это в публичный репозиторий.**
</Warning>

Чтобы подтвердить, что кошелек был импортирован как аккаунт `deployer` в вашем проекте Foundry, выполните:

```bash
cast wallet list
```

### Развертывание смарт-контракта

Чтобы развернуть смарт-контракт, вы можете использовать команду `forge create`. Команда требует указать смарт-контракт, который вы хотите развернуть, RPC-URL сети, в которую вы хотите развернуть, и аккаунт, от имени которого вы хотите развернуть.

<Info>
Ваш кошелек должен быть пополнен ETH в тестовой сети Base Goerli для покрытия комиссий за газ, связанных с развертыванием смарт-контракта. В противном случае развертывание завершится неудачей.

Чтобы получить тестовый ETH, см. [предварительные требования](#prerequisites).
</Info>

Чтобы развернуть смарт-контракт в тестовой сети Base Goerli, выполните следующую команду:

```bash
forge create ./src/Counter.sol:Counter --rpc-url https://goerli.base.org --account deployer
```

Когда будет предложено, введите пароль, который вы установили ранее при импорте приватного ключа вашего кошелька.

После выполнения команды выше контракт будет развернут в тестовой сети Base Goerli. Вы можете просмотреть статус развертывания и контракт, используя [обозреватель блоков](/base-chain/tools/block-explorers).

## Настройка Paymaster и Bundler

Чтобы настроить paymaster и bundler для вашего проекта, вам нужно посетить [дашборд Biconomy](https://dashboard.biconomy.io/) и выполнить следующие шаги.

### Регистрация paymaster

Добавьте и зарегистрируйте Paymaster, выполнив следующие шаги:

1. Войдите в [дашборд Biconomy](https://dashboard.biconomy.io/)
1. Из дашборда выберите вкладку **Paymasters** и нажмите **Add your first Paymaster**
1. Укажите **Name** для вашего paymaster
1. Выберите **Base Goerli** из выпадающего списка **Network**
1. Нажмите **Register**

Теперь у вас должен быть зарегистрированный paymaster от Biconomy.

<Info>
**API-ключ** и **Paymaster URL** для paymaster предоставляются на вкладке **Overview** в [дашборде Biconomy](https://dashboard.biconomy.io/).
</Info>

### Настройка газового резервуара (gas tank) paymaster

Настройте и пополните газовый резервуар paymaster, выполнив следующие шаги:

1. Из [dashboard](https://dashboard.biconomy.io/), перейдите на вкладку **Paymasters**
1. Нажмите **Setup gas tank** на paymaster
1. Перейдите в **Gas-Tank > Deposit**, и нажмите **Set up gas tank**
1. Подпишите сообщение своим подключенным кошельком, чтобы настроить газовый резервуар
1. Нажмите **Go to deposit**
1. Введите количество ETH, которое вы хотите внести
1. Нажмите **Deposit**

Теперь ETH должен быть внесен в газовый резервуар вашего paymaster. Вы можете посетить вкладку Withdraw позже, если захотите вывести средства.

### Настройка политик (policies) paymaster

Настройте политики paymaster, выполнив следующие шаги:

1. Из [dashboard](https://dashboard.biconomy.io/), перейдите на вкладку **Paymasters**
1. Выберите paymaster для настройки
1. Перейдите в **Policies > Contracts**, и нажмите **Add your first contract**
1. Добавьте **Name** и **Smart contract address** для вашего контракта
1. Выберите методы записи **increment** и **setNumber** как методы для спонсирования
1. Нажмите **Add Smart Contract**

### Настройка bundler

1. Войдите в [дашборде Biconomy](https://dashboard.biconomy.io/)
1. Из дашборда выберите вкладку **Bundlers**

<Info>
На момент написания этого учебника сервис Bundler все еще находится в разработке, однако **Bundler URL** предоставляется для тестирования UserOperations в тестовых сетях. Вы можете указать chain ID **84531**, чтобы использовать Bundler URL в тестовой сети **Base Goerli**.
</Info>

## Настройка фронтенда

### Создание проекта Next.js

После того как вы настроили свой paymaster и bundler из Дашборда Biconomy, следующий шаг - создать проект Next.js для фронтенда вашего приложения.

Из корневой директории `myproject` вашего проекта создайте новый проект Next.js, выполнив следующую команду:

```bash
yarn create next-app
cd my-app
```

### Установка зависимостей

Чтобы использовать paymaster и bundler, настроенные из Дашборда Biconomy, вам нужно добавить несколько зависимостей в ваш проект Next.js.

Чтобы установить Biconomy как зависимость в ваш проект, выполните следующую команду:

```bash
yarn add @biconomy/account @biconomy/bundler @biconomy/common @biconomy/core-types @biconomy/paymaster ethers@5.7.2
```

Создание умных аккаунтов Biconomy требует signer от провайдера [EIP-1193](https://eips.ethereum.org/EIPS/eip-1193). Biconomy работает с различными решениями для социального входа (social login) и встроенных кошельков (embedded wallet), которые предоставляют доступ к signer, который может использоваться для создания умных аккаунтов. В этом учебнике вы будете использовать [Particle Network](https://particle.network/) для аутентификации пользователей и получения signer для умного аккаунта.

Чтобы установить Particle Network как зависимость в ваш проект, выполните следующую команду:

```bash
yarn add @biconomy/particle-auth
```

### Обновление шаблонного кода

Главная страница (`page.tsx`) проекта Next.js, созданного при выполнении команды `yarn create next-app`, содержит компонент `Home`. Этот компонент поставляется с большим количеством кода, который не нужен для этого учебника.

Замените содержимое файла `page.tsx` следующим упрощенным кодом:

```javascript
'use client';

import styles from './page.module.css';

export default function Home() {
  return (
    <main className={styles.main}>
      <div></div>
    </main>
  );
}
```

## AДобавление социального входа с использованием Particle Network

### Настройка Particle Network

Чтобы начать добавлять социальный вход в приложение с помощью Particle Network, импортируйте и инициализируйте модуль Biconomy Particle Auth в файле `page.tsx`, как показано ниже:

```javascript
'use client';

import styles from './page.module.css';
import { ParticleAuthModule, ParticleProvider } from '@biconomy/particle-auth';

const PARTICLE_PROJECT_ID = 'YOUR_PARTICLE_PROJECT_ID';
const PARTICLE_CLIENT_ID = 'YOUR_PARTICLE_CLIENT_ID';
const PARTICLE_APP_ID = 'YOUR_PARTICLE_APP_ID';

const particle = new ParticleAuthModule.ParticleNetwork({
  projectId: PARTICLE_PROJECT_ID,
  clientKey: PARTICLE_CLIENT_ID,
  appId: PARTICLE_APP_ID,
  wallet: {
    displayWalletEntry: true,
  },
});

export default function Home() {
  return (
    <main className={styles.main}>
      <div></div>
    </main>
  );
}
```

<Info>
Вам нужно будет зарегистрироваться в Particle Network и заменить значения `PARTICLE_PROJECT_ID`, `PARTICLE_CLIENT_ID` и `PARTICLE_APP_ID`.
</Info>

<Warning>
Если вы столкнетесь с проблемами интеграции Paymaster, убедитесь, что ваши API-ключи верны и ваш контракт добавлен в белый список (whitelisted) в дашборде Biconomy.
</Warning>
