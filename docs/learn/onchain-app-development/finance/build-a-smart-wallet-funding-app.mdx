---
title: Добавление встроенной покупки в приложение с помощью OnchainKit
description: Узнайте, как создать приложение, которое определяет, есть ли у смарт-кошелька ETH, и предлагает пользователям пополнить баланс при необходимости.
authors: [hughescoin]
---

# Добавление встроенной покупки в приложение с помощью OnchainKit

В этом руководстве вы узнаете, как создать ончейн-приложение, которое проверяет баланс кошелька пользователя и либо позволяет ему отминтить NFT, либо предлагает пополнить баланс. Мы будем использовать шаблон приложения OnchainKit в качестве отправной точки.

## Цели

К концу этого руководства вы должны уметь:

- Настроить проект с использованием шаблона приложения Onchain Kit
- Сконфигурировать приложение для простой адаптации пользователей с помощью [Smart Wallets]
- Реализовать проверку баланса и условный рендеринг
- Использовать компонент Fund, чтобы позволить пользователям пополнять свой кошелек

## Предварительные требования

### React и TypeScript

Вы должны быть знакомы с React и TypeScript. Если вы новичок в этих технологиях, рассмотрите возможность предварительного ознакомления с их [official documentation].

### OnchainKit

В этом руководстве используется Onchain Kit от Coinbase. Знакомство с его основными концепциями будет полезно.

### Доступ к Coinbase Developer Platform

Вам нужно будет настроить учетную запись в [Coinbase Developer Platform (CDP) Account](https://www.coinbase.com/cloud). CDP предоставляет различные инструменты и услуги для разработки блокчейн-приложений, включая доступ к конечным точкам API и другим ресурсам, которые будут полезны в вашем проекте. После создания учетной записи вы будете готовы интегрировать эти сервисы в ваше приложение.

<Tip>
**Конфигурации CDP:**

Если при переходе на pay.coinbase.com, вы видите сообщение об ошибке "что-то пошло не так", убедитесь, что опция "enforce secure initialization" отключена на в дашборде Coinbase Developer Platform.

![fund-onramp-config](/images/onchainkit-tutorials/fund-onramp-config.png)
</Tip>

## Настройка проекта

Чтобы начать, клонируйте шаблон приложения Onchain Kit, выполнив в терминале

```bash
git clone git@github.com:coinbase/onchain-app-template.git
```

затем перейдите в директорию проекта:

```bash
cd onchain-app-template
```

Затем установите необходимые зависимости, выполнив `bun install`, а затем `bun install viem`.

После настройки проекта вам нужно будет сконфигурировать переменные окружения. Создайте файл `.env` в корневой директории вашего проекта и добавьте следующую строку: `NEXT_PUBLIC_WC_PROJECT_ID=your_project_id_here`. Не забудьте заменить 'your_project_id_here' на ваш реальный идентификатор проекта. Кроме того, не забудьте настроить ваш `apiKey` в файле `src/app/components/OnchainProviders.tsx`.

## Конфигурация для смарт-кошельков

Чтобы заставить приложение работать только со смарт-кошельками, измените `src/wagmi.ts`:

```typescript
// Внутри функции useWagmiConfig(), перед хуком useMemo()
coinbaseWallet.preference = 'smartWalletOnly';
```

## Реализация проверки баланса

Теперь реализуем проверку кошелька пользователя, чтобы узнать, достаточно ли у него средств. Прежде чем реализовать эту проверку, давайте создадим вспомогательную функцию, которая получает баланс Ethereum пользователя с помощью [viem]. Для этого создайте файл `utils.ts` в директории `src`, который создает клиент, подключенный к Base, и получает баланс ETH пользователя:

```typescript
import { createPublicClient, http } from 'viem';
import { base } from 'viem/chains';
import type { GetBalanceParameters } from 'viem';

const publicClient = createPublicClient({
  transport: http(),
  chain: base,
});

export async function getBalance(address: GetBalanceParameters) {
  const balance = publicClient.getBalance(address);
  return balance;
}
```

Затем импортируйте функцию `getBalance()` в ваш основной файл компонента (например, `src/app/page.tsx`). Вам нужно будет добавить несколько , чтобы получить баланс и сохранить его как переменную состояния. Добавьте следующие строки кода в ваш файл `page.tsx`:

```typescript
import { useState, useEffect } from 'react';
import { getBalance } from '../utils';
import { FundButton } from '@coinbase/onchainkit/fund';

// Внутри вашего компонента
const [walletBalance, setWalletBalance] = useState('');

useEffect(() => {
  async function fetchBalance() {
    if (address) {
      const balance = await getBalance({ address });
      setWalletBalance(String(balance));
    }
  }
  fetchBalance();
}, [address]);
```

## Реализация условного рендеринга

Теперь, когда мы знаем баланс пользователя, мы можем позволить ему отминтить NFT или предложить ему пополнить кошелек, если у него недостаточно ETH.

Конечная цель - показать его баланс вместе с соответствующим призывом к действию, как показано ниже:

![fund-wallet](/images/onchainkit-tutorials/fund-wallet-balance.png)

Обновите оператор `return` вашего компонента следующим кодом:

```typescript
return (
  <div className="flex h-full w-96 max-w-full flex-col px-1 md:w-[1008px]">
    {/* ... other sections ... */}
    <section className="templateSection flex w-full flex-col items-center justify-center gap-4 rounded-xl bg-zinc-100 px-2 py-4 md:grow">
      <div className="flex h-[450px] w-[450px] max-w-full items-center justify-center rounded-xl bg-[#030712]">
        <div className="rounded-xl bg-[#F3F4F6] px-4 py-[11px]">
          <p className="text-xl font-normal not-italic tracking-[-1.2px] text-indigo-600">
            Your Wallet has {walletBalance} ETH
          </p>
        </div>
      </div>
      {address ? (
        parseFloat(walletBalance) > 0 ? (
          <TransactionWrapper address={address} />
        ) : (
          <FundButton text={'Add funds to transact'} />
        )
      ) : (
        <WalletWrapper className="w-[450px] max-w-full" text="Sign in to transact" />
      )}
    </section>
    <Footer />
  </div>
);
```

Отлично! Теперь наш условный рендеринг работает в полную силу. Если пользователь нажмет кнопку `+ Add funds to transact`, ему будут предоставлены три варианта пополнения его смарт-кошелька:

![fund-wallet](/images/onchainkit-tutorials/fund-funding-options.png)

## Заключение

Поздравляем! Вы создали приложение, которое проверяет баланс смарт-кошелька пользователя и предоставляет соответствующие варианты действий в зависимости от его средств.
Это приложение может служить основой для более сложных ончейн-приложений, требующих от пользователей наличия пополненных смарт-кошельков.

[Onchain Kit]: https://github.com/coinbase/onchainkit
[Viem]: https://viem.sh/
[Smart Wallets]: https://keys.coinbase.com/onboarding
[viem]: https://viem.sh/docs/introduction
[react hooks]: https://react.dev/reference/react/hooks
[Onramp config page]: https://portal.cdp.coinbase.com/products/onramp
[official documentation]: https://react.dev/

