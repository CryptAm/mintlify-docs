---
title: Хук `useSimulateContract`
description: Улучшите пользовательский опыт с помощью хука `useSimulateContract`.
hide_table_of_contents: false
---

# Хук `useSimulateContract`
Хук [`useSimulateContract`] симулирует и проверяет взаимодействие с контрактом без фактической отправки транзакции в блокчейн. Его использование позволяет вам обнаруживать и реагировать на потенциальные ошибки до того, как пользователь попытается отправить транзакцию.

---

## Цели

К концу этого руководства вы должны уметь:

- Реализовать wagmi `useSimulateContract` и `useWriteContract` для отправки транзакций в смарт-контракт
- Настраивать опции в `useSimulateContract` и `useWriteContract`
- Вызывать функцию смарт-контракта по требованию, используя функцию write из `useWriteContract`, с аргументами и значением (value)

---

## Улучшение компонента Claim

В предыдущем пошаговом руководстве вы использовали [`useWriteContract`] для настройки хука, который можно использовать для вызова функции claim в вашем смарт-контракте, когда пользователь нажимает кнопку. Компонент работает достаточно хорошо, но может потребоваться много времени для появления окна кошелька, особенно при высокой загрузке сети. У вас также нет возможности отреагировать на проблему с входными данными транзакции до того, как пользователь попытается инициировать транзакцию.

### Использование `useSimulateContract`

`useSimulateContract` можно использовать в паре с `useWriteContract`. Для этого вы настраиваете параметры транзакции в `useSimulateContract`, а затем используете возвращаемое `data?.request` в качестве аргумента при вызове записи в контракт. Измените ваш компонент `TokenInfo`, чтобы протестировать это:

```tsx
const {
  data: claimData,
  isFetching: claimIsFetching,
  isError: claimIsError,
} = useSimulateContract({
  address: contractData.address as `0x${string}`,
  abi: contractData.abi,
  functionName: 'claim',
});

useEffect(() => {
  if (claimIsError) {
    alert('Unable to claim'); // TODO: Улучшить обработку ошибок
  }
}, [claimIsError]);

const { writeContract: claim, isPending: claimIsPending } = useWriteContract();

const handleClaimClick = () => {
  claim(claimData?.request);
};
```

Вам также нужно будет обновить ваш обработчик, чтобы использовать функцию предварительной проверки TypeScript, потому что функция claim будет кратковременно `undefined`.

```tsx
const handleClaimClick = () => {
  claim(claimData!.request);
};
```

Перезагрузите сайт и обратите внимание, что `alert` срабатывает при загрузке, если вы вошли с адресом, который уже получил токены. Вы также увидите, что кнопка отключена, как будто пользователь нажал на нее и транзакция загружается в кошельке.

### Внесение корректировок

Причина этого - тонкое различие в том, как работают `useWriteContract` и `useSimulateContract`.

В предыдущем пошаговом руководстве вы видели, как viem запускает симуляцию транзакции при вызове функции `write`. `useSimulateContract` активно запускает эту симуляцию и обновляет свои переменные.

Вам нужно внести некоторые изменения, чтобы это работало. Переменная `claimIsError` срабатывает, когда данные для вызова **симулируются**, а не когда вызов завершен. В результате она немедленно генерирует ошибку и вызывает alert без необходимости нажатия пользователем кнопки.

Вы можете решить эту проблему несколькими способами, включая простое отсутствие рендеринга кнопки, если пользователь уже получил токены. Вы также можете изменить код и объединить его с `isError`, чтобы поделиться этой информацией с пользователем.

```tsx
const {
  data: claimData,
  isFetching: claimIsFetching,
  isError: claimIsError,
} = useSimulateContract({
  address: contractData.address as `0x${string}`,
  abi: contractData.abi,
  functionName: 'claim',
});

const { writeContract: claim, isPending: claimIsPending } = useWriteContract();

return (
  <div>
    <p>{claimIsFetching.toString()}</p>
    <p>{'Token Balance: ' + tokenBalance}</p>
    <button disabled={claimIsPending || claimIsError} onClick={handleClaimClick}>
      {claimIsPending ? 'Complete In Wallet' : 'Claim Tokens'}
    </button>
    <p>{claimIsError ? 'Unable to claim tokens.' : 'Claim your tokens!'} </p>
  </div>
);
```

---

## Заключение

В этом пошаговом руководстве вы обновили ваше приложение, чтобы использовать хук `useSimulateContract` для предоставления более быстрого взаимодействия с кошельком для ваших пользователей. Вы также узнали, как можно прогнозировать и реагировать на потенциальные ошибки без необходимости отправки транзакции пользователем. Вы могли бы использовать эту функциональность, чтобы сообщить им, что имя пользователя уже занято, сумма ставки недостаточно велика или товар больше не доступен.

---

[wagmi]: https://wagmi.sh/
[`useWriteContract`]: https://wagmi.sh/react/hooks/useWriteContract
[`useSimulateContract`]: https://wagmi.sh/react/hooks/useSimulateContract

