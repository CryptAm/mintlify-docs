---
title: "Контекст мини-приложения"
description: "Улучшите пользовательский опыт, мгновенно отображая данные профиля пользователя и настраивая пользовательские потоки на основе того, откуда было открыто ваше мини-приложение"
sidebarTitle: "Контекст"
---

Когда ваше приложение открыто как мини-приложение, `sdk.context` предоставляет 4 объекта данных:

- `user`: Данные профиля пользователя
- `location`: Место, откуда было открыто мини-приложение
- `client`: Хостинговая платформа (например, Base app или другой клиент Farcaster) и данные устройства
- `features`: Доступность и состояние функций в текущем клиенте

<Panel>

```ts  MiniAppContextTypes.ts
export type MiniAppPlatformType = 'web' | 'mobile';
 
export type MiniAppContext = {
  user: {
    fid: number;
    username?: string;
    displayName?: string;
    pfpUrl?: string;
  };
  location?: MiniAppLocationContext;
  client: {
    platformType?: MiniAppPlatformType;
    clientFid: number;
    added: boolean;
    safeAreaInsets?: SafeAreaInsets;
    notificationDetails?: MiniAppNotificationDetails;
  };
  features?: {
    haptics: boolean;
    cameraAndMicrophoneAccess?: boolean;
  };
};
```
</Panel>

## Реализация

1. Установите и импортируйте `@farcaster/miniapp-sdk`
2. Проверьте, открыто ли приложение как мини-приложение, используя `sdk.isInMiniApp();`
3. Если в мини-приложении, загрузите объект контекста, используя `sdk.context`


В примере ниже мы определяем, было ли приложение открыто как мини-приложение, и если да, то возвращаем имя пользователя, fid, отображаемое имя и изображение профиля пользователя.

```typescript app/profile/page.tsx
"use client";
import { sdk } from "@farcaster/miniapp-sdk";
import { useEffect, useState } from "react";

export default function Profile() {
  const [user, setUser] = useState(null);
  const [isInMiniApp, setIsInMiniApp] = useState(false); 

  useEffect(() => {
    const loadUserData = async () => {
      try {
        // Проверить, находимся ли мы в мини-приложении
        const miniAppStatus = await sdk.isInMiniApp();
        setIsInMiniApp(miniAppStatus);

        if (miniAppStatus) {
          // Получить контекст и извлечь информацию о пользователе
          const context = await sdk.context;
          setUser(context.user);
        }
      } catch (error) {
        console.error("Error loading user data:", error);
      }
    };

    loadUserData();
  }, []);

  // Показать сообщение, если не в мини-приложении
  if (!isInMiniApp) {
    return (
      <div>
        <p>Please open this app in a Farcaster or Base client to see your profile.</p>
      </div>
    );
  }

  // Показать информацию о пользователе
  if (user) {
    return (
      <div>
        <h2>Welcome, {user.displayName || user.username}!</h2>
        <p>FID: {user.fid}</p>
        <p>Username: @{user.username}</p>
        {user.pfpUrl && (
          <img 
            src={user.pfpUrl} 
            alt="Profile" 
            width={64} 
            height={64} 
            style={{ borderRadius: '50%' }}
          />
        )}
      </div>
    );
  }

  return <div>Loading user profile...</div>;
}
```

## Схема


### Объект User

Содержит информацию профиля пользователя. Эти данные не должны использоваться для аутентификации или чувствительных действий, поскольку они передаются приложением.

<Card>
<ParamField path="fid" type="number" required>
Уникальный идентификатор Farcaster для пользователя.
</ParamField>

<ParamField path="username" type="string">
Псевдоним без символа @.
</ParamField>

<ParamField path="displayName" type="string">
Выбранное пользователем отображаемое имя.
</ParamField>

<ParamField path="pfpUrl" type="string">
URL изображения профиля.
</ParamField>

<ParamField path="bio" type="string">
Текст биографии пользователя.
</ParamField>

<ParamField path="location" type="object">
Информация о местоположении пользователя.
</ParamField>

<ParamField path="location.placeId" type="string">
Google Places ID.
</ParamField>

<ParamField path="location.description" type="string">
Читаемое человеком описание местоположения.
</ParamField>


</Card>

```json user.json
{
  "fid": 6841,
  "username": "deodad",
  "displayName": "Tony D'Addeo",
  "pfpUrl": "https://i.imgur.com/dMoIan7.jpg",
  "bio": "Building @warpcast and @farcaster",
  "location": {
    "placeId": "ChIJLwPMoJm1RIYRetVp1EtGm10",
    "description": "Austin, TX, USA"
  }
}
```
### Объект Location

Содержит информацию о контексте, из которого было запущено мини-приложение. Это помогает понять, как пользователи обнаружили и получили доступ к вашему приложению.

**Типы местоположения:**
- **`cast_embed`**: Запущено из каста, где ваше приложение встроено
- **`cast_share`**: Запущено, когда пользователь поделился кастом в ваше приложение
- **`notification`**: Запущено из уведомления, вызванного вашим приложением
- **`launcher`**: Запущено напрямую из каталога приложений клиента
- **`channel`**: Запущено из определённого канала Farcaster
- **`open_miniapp`**: Запущено из другого мини-приложения

#### CastEmbedLocationContext

<Card>
<ParamField path="type" type="'cast_embed'" required>
Указывает, что мини-приложение было запущено из каста, где оно является встраиванием.
</ParamField>

<ParamField path="embed" type="string" required>
URL встраивания.
</ParamField>

<ParamField path="cast" type="MiniAppCast" required>
Информация о касте, содержащем встраивание.
</ParamField>
</Card>

```json cast_embed.json
{
  "type": "cast_embed",
  "embed": "https://myapp.example.com",
  "cast": {
    "author": {
      "fid": 3621,
      "username": "alice",
      "displayName": "Alice",
      "pfpUrl": "https://example.com/alice.jpg"
    },
    "hash": "0xa2fbef8c8e4d00d8f84ff45f9763b8bae2c5c544",
    "timestamp": 1749160866000,
    "text": "Check out this awesome mini app!",
    "embeds": ["https://myapp.example.com"],
    "channelKey": "farcaster"
  }
}
```

#### CastShareLocationContext

<Card>
<ParamField path="type" type="'cast_share'" required>
Указывает, что мини-приложение было запущено, когда пользователь поделился кастом в ваше приложение.
</ParamField>

<ParamField path="cast" type="MiniAppCast" required>
Каст, которым поделились в ваше приложение.
</ParamField>
</Card>

#### NotificationLocationContext

<Card>
<ParamField path="type" type="'notification'" required>
Указывает, что мини-приложение было запущено из уведомления.
</ParamField>

<ParamField path="notification" type="object" required>
Детали уведомления.
<ParamField path="notification.notificationId" type="string" required>
Уникальный идентификатор уведомления.
</ParamField>
<ParamField path="notification.title" type="string" required>
Заголовок уведомления.
</ParamField>
<ParamField path="notification.body" type="string" required>
Текст тела уведомления.
</ParamField>
</ParamField>
</Card>



```json notification.json
{
  "type": "notification",
  "notification": {
    "notificationId": "f7e9ebaf-92f0-43b9-a410-ad8c24f3333b",
    "title": "Yoinked!",
    "body": "horsefacts captured the flag from you."
  }
}
```

#### LauncherLocationContext

<Card>
<ParamField path="type" type="'launcher'" required>
Указывает, что мини-приложение было запущено напрямую клиентом вне контекста.
</ParamField>
</Card>

#### ChannelLocationContext

<Card>
<ParamField path="type" type="'channel'" required>
Указывает, что мини-приложение было запущено из определённого канала Farcaster.
</ParamField>

<ParamField path="channel" type="object" required>
Детали канала.
</ParamField>

<ParamField path="channel.key" type="string" required>
Ключ-идентификатор канала.
</ParamField>

<ParamField path="channel.name" type="string" required>
Название канала.
</ParamField>

<ParamField path="channel.imageUrl" type="string">
URL изображения профиля канала.
</ParamField>

</Card>

#### OpenMiniAppLocationContext

<Card>
<ParamField path="type" type="'open_miniapp'" required>
Указывает, что мини-приложение было запущено из другого мини-приложения.
</ParamField>

<ParamField path="referrerDomain" type="string" required>
Домен мини-приложения, которое открыло текущее приложение.
</ParamField>
</Card>

### Объект Client

Содержит подробности о клиенте Farcaster, запускающем ваше мини-приложение. Эти данные следует считать ненадёжными.


#### ClientContext

<Card>
<ParamField path="platformType" type="'web' | 'mobile'">
Платформа, на которой работает приложение.
</ParamField>

<ParamField path="clientFid" type="number" required>
Самостоятельно сообщаемый FID клиента (например, 9152 для Farcaster).
</ParamField>

<ParamField path="added" type="boolean" required>
Добавил ли пользователь ваше мини-приложение в свой клиент.
</ParamField>

<ParamField path="safeAreaInsets" type="object">
Отступы экрана для избегания навигационных элементов, которые перекрывают вид.
<Expandable title="properties">
<ParamField path="top" type="number" required>
Верхний отступ безопасной области в пикселях.
</ParamField>
<ParamField path="bottom" type="number" required>
Нижний отступ безопасной области в пикселях.
</ParamField>
<ParamField path="left" type="number" required>
Левый отступ безопасной области в пикселях.
</ParamField>
<ParamField path="right" type="number" required>
Правый отступ безопасной области в пикселях.
</ParamField>
</Expandable>
</ParamField>

<ParamField path="notificationDetails" type="object">
Конфигурация уведомлений, если включена.
<Expandable title="properties">
<ParamField path="url" type="string" required>
Конечная точка для отправки уведомлений.
</ParamField>
<ParamField path="token" type="string" required>
Токен аутентификации для уведомлений.
</ParamField>
</Expandable>
</ParamField>
</Card>

```json client.json
{
  "platformType": "mobile",
  "clientFid": 9152,
  "added": true,
  "safeAreaInsets": {
    "top": 0,
    "bottom": 20,
    "left": 0,
    "right": 0
  },
  "notificationDetails": {
    "url": "https://api.farcaster.xyz/v1/frame-notifications",
    "token": "a05059ef2415c67b08ecceb539201cbc6"
  }
}
```


### Объект Features

Указывает, какие функции платформы доступны и их текущее состояние в клиенте.

<Card>
<ParamField path="haptics" type="boolean" required>
Поддерживается ли тактильная обратная связь на текущей платформе.
</ParamField>

<ParamField path="cameraAndMicrophoneAccess" type="boolean">
Предоставлены ли и сохранены разрешения на камеру и микрофон для этого мини-приложения.
</ParamField>
</Card>

```json features.json
{
  "haptics": true,
  "cameraAndMicrophoneAccess": true
}
```

<Note>Для более детального обнаружения возможностей используйте метод `sdk.getCapabilities()`, который возвращает конкретные методы SDK, поддерживаемые хостом.</Note>
