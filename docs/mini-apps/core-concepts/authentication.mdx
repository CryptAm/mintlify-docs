---
title: Аутентификация
description: Quick Auth предоставляет мгновенную аутентификацию, используя систему идентификации Farcaster - без паролей, проверки email или сложных OAuth-процессов.
---

Когда вызывается Quick Auth:

* Пользователь аутентифицируется с помощью подписи
* SDK возвращает JWT, который ваш бэкенд проверяет для подтверждения идентичности пользователя
* Бэкенд возвращает доверенные данные, которые можно использовать для чувствительных действий

<Tip>
Это отличается от [Context API](/mini-apps/core-concepts/context), которая предоставляет мгновенный доступ к информации о пользователе без аутентификации, но не может быть доверена для чувствительных операций.
</Tip>


## Реализация

### Шаг 1: Аутентификация на фронтенде

Этот код аутентифицирует пользователя с помощью Quick Auth, сохраняет JWT в памяти и использует его для проверки идентичности пользователя с вашим бэкендом.

 ```jsx App.tsx
import { useState } from "react";
import { sdk } from "@farcaster/miniapp-sdk";

export function App() {
  const [token, setToken] = useState<string | null>(null);
  const [userData, setUserData] = useState<{ fid: number} | null>(null);

  async function signIn() {
    try {
      const { token } = await sdk.quickAuth.getToken();
      setToken(token);
      
      // Использовать токен для аутентификации пользователя и получения данных аутентифицированного пользователя
      const response = await sdk.quickAuth.fetch(`${BACKEND_ORIGIN}/auth`, {
        headers: { "Authorization": `Bearer ${token}` }
      });
      
      const data = await response.json();
      setUserData(data);
    } catch (error) {
      console.error("Authentication failed:", error);
    }
  }

  function signOut() {
    setToken(null);
    setUserData(null);
  }

  if (!token) {
    return <button onClick={signIn}>Sign In</button>;
  }

  return (
    <div>
      <p>Authenticated as FID: {userData?.fid}</p>
      <button onClick={signOut}>Sign Out</button>
    </div>
  );
}
```

### Шаг 2: Проверка на бэкенде

Установите клиент Quick Auth:

```bash
npm install @farcaster/quick-auth
```

**Клиент Quick Auth** - это SDK, который инициирует процесс аутентификации в вашем приложении.

**Сервер Quick Auth** - это сервис Farcaster, который обрабатывает проверку подписи и выдаёт JWT.

Когда пользователь аутентифицируется, сервер Quick Auth проверяет его подпись и выдаёт JWT. Ваш бэкенд проверяет этот JWT с помощью пакета `@farcaster/quick-auth`.

```jsx route.tsx
// app/api/auth/route.ts
import { createClient, Errors } from '@farcaster/quick-auth';
import { NextRequest, NextResponse } from 'next/server';

const domain = 'your-domain.com'; // Должен соответствовать домену развёртывания вашего мини-приложения
const client = createClient();

// Эта конечная точка возвращает FID аутентифицированного пользователя
export async function GET(request: NextRequest) {
  const authorization = request.headers.get('Authorization');
  if (!authorization?.startsWith('Bearer ')) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }

  const token = authorization.split(' ')[1];

  try {
    const payload = await client.verifyJwt({ token, domain });
    
    return NextResponse.json({
      fid: payload.sub,
    });
  } catch (e) {
    if (e instanceof Errors.InvalidTokenError) {
      return NextResponse.json({ error: 'Invalid token' }, { status: 401 });
    }
    throw e;
  }
}
```

## Схема

### Полезная нагрузка JWT


```json
{
  "iat": 1747764819,
  "iss": "https://auth.farcaster.xyz",
  "exp": 1747768419,
  "sub": 6841,
  "aud": "your-domain.com" 
}
```
Поля полезной нагрузки:

<Card>
<ParamField path="iat" type="number">
Временная метка выдачи
</ParamField>

<ParamField path="iss" type="string">
Сервер Quick Auth, выдавший JWT
</ParamField>

<ParamField path="exp" type="number">
Временная метка истечения срока действия (1 час с момента выдачи)
</ParamField>

<ParamField path="sub" type="number">
Farcaster ID (FID) пользователя
</ParamField>

<ParamField path="aud" type="string">
Домен вашего мини-приложения
</ParamField>
</Card>


<CardGroup cols={2}>
<Card title="useAuthenticate" href="/onchainkit/latest/components/minikit/hooks/useAuthenticate">
  Используйте хук useAuthenticate из Minikit для аутентификации пользователей.
</Card>
<Card title="Context" href="/mini-apps/core-concepts/context">
  Узнайте, как используется контекст в мини-приложениях.
</Card>
</CardGroup>

