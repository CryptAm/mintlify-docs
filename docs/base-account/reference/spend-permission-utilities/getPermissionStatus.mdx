---
title: "getPermissionStatus"
description: "Получает текущий статус разрешения на расходование"
---

Определено в [Base Account SDK](https://github.com/base/account-sdk)

<Info>
  Этот вспомогательный метод выполняет запрос к блокчейну для получения информации
  о разрешении на расходование в реальном времени, включая оставшуюся доступную для
  траты сумму в текущем периоде, время начала следующего периода и активность разрешения.
  
  Функция автоматически использует соответствующий клиент блокчейна на основе
  идентификатора цепочки (chain ID) разрешения и вызывает несколько функций чтения
  контракта SpendPermissionManager для сбора полной информации о статусе.
</Info>

## Параметры

<ParamField body="permission" type="SpendPermission" required>
  Объект разрешения на расходование, для которого проверяется статус. Это должен быть объект SpendPermission, полученный из [`requestSpendPermission`](/base-account/reference/spend-permission-utilities/requestSpendPermission) или запрошенный через [`fetchPermissions`](/base-account/reference/spend-permission-utilities/fetchPermissions).

<Expandable title="Свойства SpendPermission">
<ParamField body="permissionHash" type="string">
Детерминированный хеш EIP-712 разрешения.
</ParamField>

<ParamField body="signature" type="string">
  Подпись для полезной нагрузки EIP-712.
</ParamField>

<ParamField body="chainId" type="number">
  Идентификатор целевой цепочки (chain ID).
</ParamField>

<ParamField body="permission" type="object">
Базовые поля разрешения.

<Expandable title="Поля permission">
<ParamField body="account" type="address" />
<ParamField body="spender" type="address" />
<ParamField body="token" type="address" />
<ParamField body="allowance" type="bigint" />
<ParamField body="period" type="number">Длительность в секундах.</ParamField>
<ParamField body="start" type="number">Временная метка Unix (секунды).</ParamField>
<ParamField body="end" type="number">UВременная метка Unix (секунды).</ParamField>
<ParamField body="salt" type="string" />
<ParamField body="extraData" type="string" />
</Expandable>
</ParamField>
</Expandable>
</ParamField>

## Возвращает

<ResponseField name="status" type="GetPermissionStatusResponseType">
Promise, который разрешается в объект, содержащий детали статуса разрешения.

<Expandable title="Свойства GetPermissionStatusResponseType">
<ResponseField name="remainingSpend" type="bigint">
  Оставшийся лимит в wei для текущего периода. Рассчитывается как разница между общим лимитом и суммой, уже потраченной в текущем периоде.
</ResponseField>
<ResponseField name="nextPeriodStart" type="Date">
  Время, когда начнётся следующий период лимита. Рассчитывается как одна секунда после окончания текущего периода.
</ResponseField>
<ResponseField name="isRevoked" type="boolean">
  True, если разрешение было отозвано в блокчейне.
</ResponseField>
<ResponseField name="isExpired" type="boolean">
  True, если текущее время превышает время окончания действия разрешения.
</ResponseField>
<ResponseField name="isActive" type="boolean">
  True, если разрешение не отозвано и не истекло. Разрешение считается активным, если его всё ещё можно использовать для расходования.
</ResponseField>
<ResponseField name="currentPeriod" type="object">
  Информация о текущем периоде расходования.
  
  <Expandable title="Свойства currentPeriod">
    <ResponseField name="start" type="number">Временная метка Unix (секунды) начала текущего периода.</ResponseField>
    <ResponseField name="end" type="number">Временная метка Unix (секунды) окончания текущего периода.</ResponseField>
    <ResponseField name="spend" type="bigint">Сумма, уже потраченная в текущем периоде (в wei).</ResponseField>
  </Expandable>
</ResponseField>
</Expandable>
</ResponseField>

<RequestExample>
```typescript Check permission status
import { getPermissionStatus } from "@base-org/account/spend-permission";

// Проверить статус разрешения (клиент не требуется)
const status = await getPermissionStatus(permission);

console.log(`Remaining spend: ${status.remainingSpend} wei`);
console.log(`Next period starts: ${status.nextPeriodStart}`);
console.log(`Is revoked: ${status.isRevoked}`);
console.log(`Is expired: ${status.isExpired}`);
console.log(`Is active: ${status.isActive}`);

if (status.isActive && status.remainingSpend > BigInt(0)) {
  console.log('Permission can be used for spending');
}
```
</RequestExample>

<ResponseExample>
```typescript Example response
{
  remainingSpend: 1000000000000000000n,
  nextPeriodStart: new Date("2024-01-31T00:00:01Z"),
  isRevoked: false,
  isExpired: false,
  isActive: true,
  currentPeriod: {
    start: 1704067200,
    end: 1706659200,
    spend: 0n
  }
}
```

</ResponseExample>

## Обработка ошибок

Всегда заключайте вызов в блок `try-catch` для корректной обработки возможных ошибок.

import PolicyBanner from "/snippets/PolicyBanner.mdx";

<PolicyBanner />
