---
title: "SDK Utilities"
description: "Основные служебные функции для управления ключами и доступа к аккаунтам"
---

Base Account SDK предоставляет несколько основных служебных функций для управления криптографическими ключами и доступа к информации об аккаунтах. Эти функции важны для расширенных интеграций и управления Sub Accounts.

## Основные функции

### [generateKeyPair](/base-account/reference/core/generateKeyPair)

Генерирует новую пару ключей P256 для использования с Base Account.

```tsx
import { generateKeyPair } from '@base-org/account';

const keyPair = await generateKeyPair();
console.log('New key pair generated:', keyPair);
```

### [getKeypair](/base-account/reference/core/getKeypair)

Извлекает существующую пару ключей P256, если она была ранее сгенерирована и сохранена.

```tsx
import { getKeypair } from '@base-org/account';

const existingKeyPair = await getKeypair();
if (existingKeyPair) {
  console.log('Found existing key pair');
} else {
  console.log('No existing key pair found');
}
```

### [getCryptoKeyAccount](/base-account/reference/core/getCryptoKeyAccount)


```tsx
import { getCryptoKeyAccount } from '@base-org/account';

const cryptoAccount = await getCryptoKeyAccount();
if (cryptoAccount?.account) {
  console.log('Account address:', cryptoAccount.account.address);
  console.log('Public key:', cryptoAccount.account.publicKey);
}
```

## Полный пример интеграции

Вот как эти утилиты работают вместе в типичном приложении:

```tsx
import { 
  generateKeyPair, 
  getKeypair, 
  getCryptoKeyAccount,
  createBaseAccountSDK 
} from '@base-org/account';

class AccountManager {
  private sdk: any;
  
  constructor() {
    this.sdk = createBaseAccountSDK({
      appName: 'My App',
      appLogoUrl: 'https://example.com/logo.png',
      appChainIds: [8453], // Base mainnet
    });
  }
  
  // Инициализировать управление аккаунтами
  async initialize() {
    const account = await this.getCurrentAccount();
    
    if (!account) {
      console.log('No account found, user needs to connect');
      return null;
    }
    
    return account;
  }
  
  // Получить текущий аккаунт или запросить подключение
  async getCurrentAccount() {
    const cryptoAccount = await getCryptoKeyAccount();
    return cryptoAccount?.account || null;
  }
  
  // Получить или сгенерировать пару ключей для расширенных операций
  async getKeyPair() {
    let keyPair = await getKeypair();
    
    if (!keyPair) {
      console.log('Generating new key pair...');
      keyPair = await generateKeyPair();
    }
    
    return keyPair;
  }
  
  // Пример: Использование аккаунта для создания Sub Account
  async createSubAccount() {
    const account = await this.getCurrentAccount();
    const keyPair = await this.getKeyPair();
    
    if (!account || !keyPair) {
      throw new Error('Account and key pair required');
    }
    
    // Использовать SDK для создания суб-аккаунта
    const subAccount = await this.sdk.subAccount.create({
      type: 'create',
      keys: [{
        type: 'webauthn-p256',
        publicKey: keyPair.publicKey,
      }],
    });
    
    return subAccount;
  }
  
  // Получить адрес аккаунта для транзакций
  getAccountAddress(): string | null {
    // Этот метод вызывается после инициализации
    const account = this.getCurrentAccount();
    return account?.address || null;
  }
}

// Использование
const accountManager = new AccountManager();

// Инициализировать и получить аккаунт
const account = await accountManager.initialize();

if (account) {
  console.log('User is connected:', account.address);
  
  // Создать суб-аккаунт при необходимости
  const subAccount = await accountManager.createSubAccount();
  console.log('Sub account created:', subAccount.address);
} else {
  console.log('User needs to connect their account');
}
```

## Обработка ошибок

Обрабатывайте распространенные ошибки при использовании этих утилит:

```tsx
async function safeGetAccount() {
  try {
    const cryptoAccount = await getCryptoKeyAccount();
    return cryptoAccount?.account;
  } catch (error) {
    console.error('Error getting crypto account:', error);
    
    if (error.message.includes('not initialized')) {
      // SDK не был правильно инициализирован
      throw new Error('Base Account SDK not initialized');
    } else if (error.message.includes('permission denied')) {
      // Пользователь отказал в доступе
      throw new Error('User denied account access');
    } else {
      // Неизвестная ошибка
      throw new Error('Failed to access account');
    }
  }
}
```

## Рекомендации

1. **Проверяйте существующие аккаунты**: Всегда сначала используйте getCryptoKeyAccount() для проверки, подключен ли уже пользователь

2. **Обрабатывайте возврат null**: Эти функции могут возвращать null — всегда проверяйте результат перед использованием

3. **Безопасное управление ключами**: Если используете generateKeyPair() или getKeypair(), обрабатывайте приватные ключи безопасно

4. **Обработка ошибок**: Оборачивайте вызовы в блоки try-catch для обработки ошибок аутентификации и сети

5. **Пользовательский опыт**: Предоставляйте четкую обратную связь, когда аккаунты не найдены или их нужно создать

Эти утилиты обеспечивают основу для расширенных интеграций Base Account, особенно при работе с Sub Accounts и пользовательскими потоками аутентификации.
