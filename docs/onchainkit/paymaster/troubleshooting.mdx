---
title: 'Устранение неполадок Paymaster и Bundler'
sidebar_label: Устранение неполадок
---

В этом руководстве объясняется, как устранять распространенные проблемы, с которыми вы можете столкнуться при отправке UserOperations.

## Исполнение отменено

UserOperation был размещен в цепи, но произошла ошибка в одном из смарт-контрактов, с которыми он взаимодействовал, и поэтому вся операция была отменена. Это может быть связано с:

- Недостаточно газа для оплаты исполнения
  - Попробуйте увеличить резерв для `preVerificationGas` или `callGasLimit`
- Проблема с `callData` вашей UserOperation
  - Это проблема со смарт-контрактом вашего dapp, которую вам необходимо отладить.

Для симуляции и отладки UserOperation вы можете использовать такой инструмент, как [Tenderly](https://dashboard.tenderly.co/).

### Проблема, связанная с оценкой газа

Если вы считаете, что проблема может быть связана с газом, выполните симуляцию, используя контракт Entrypoint, `0x5ff137d4b0fdcd49dca30c7cf57e578a026d2789`, и вставив вашу UserOperation в поле `tuple`.

Например, ваша UserOperation может выглядеть так:

```
{
  "callData": "0xb61d27f600000000000000000000000066519fcaee1ed65bc9e0acc25ccd900668d3ed490000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000443f84ac0e0000000000000000000000001e3143e0ed8c0ea51f1551b6c355e02f3e0baae0000000000000000000000000000000000000000000000000000000000000006400000000000000000000000000000000000000000000000000000000",
  "paymasterAndData": "0xc484bcd10ab8ad132843872deb1a0adc1473189c000066cd03db0000000000000098973f00000a968163f0a57b400000018633de6cf5e53752c5eac49e8f8ffb4ecd16b2afe7b4074086d6693536a9ab1f117bae0b427f83f94246c34d25add97b05e8a73859c2dceef6ee730ab2842bf31b",
  "sender": "0x1e3143E0ED8C0Ea51F1551B6c355e02f3e0bAae0",
  "initCode": "0x",
  "maxFeePerGas": "3000000000",
  "maxPriorityFeePerGas": "1000000000",
  "nonce": "31815307923431762811356398485504",
  "signature": "0x0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000041ca7a742cff01aa9d5e377c5a146b5d8f03a4e44bd1817b1899bf7e0ff6885ed63294c69f017fe47f385c046055cc687e503bba08513ff52fbf21dcd8019c1f1d1b00000000000000000000000000000000000000000000000000000000000000",
  "callGasLimit": "257565",
  "preVerificationGas": "96024",
  "verificationGasLimit": "87888"
}
```

Вы можете использовать функцию `simulateHandleOp` и передать эту UserOperation в поле `op` (не забудьте добавить квадратные скобки вокруг нее, поскольку технически она обрабатывает «пачку» UserOperations).

<Accordion title="Развернуть для просмотра изображений (кликните для увеличения)">
<Frame caption="Tenderly - Entrypoint">
<img
  src="/images/paymaster/pb-paymaster-tenderly-entrypoint.png"
  width="700"
  alt="Tenderly Entrypoint"
/>
</Frame>
</Accordion>

### Исполнение отменено с данными

Ошибка может выглядеть примерно так:

```
cause: {
  "code": -32004,
  "message": " - execution reverted with data",
  "data": "0xed6c3dec00000000000000000000000036e53f56454e1206f775dafe2b33c1b737c43632"
}
```

Вы можете использовать такой инструмент, как https://bia.is/tools/abi-decoder/ чтобы загрузить свой ABI, ввести данные и декодировать сообщение об ошибке. Попробуйте использовать ABI каждого смарт-контракта, с которым ваш dapp может взаимодействовать.

### Исполнение отменено по неизвестной причине

Аналогично предыдущему, за исключением того, что ваш контракт отменяется без каких-либо кодов ошибок. Попробуйте проверить код вашего смарт-контракта, ваш `callData` и использовать [Tenderly](https://dashboard.tenderly.co/), для отладки. Возможно, поможет [верификация вашего аккаунта.](https://book.getfoundry.sh/reference/forge/forge-verify-contract)

Пример ниже показывает, как отлаживать собственный смарт-контракт.

- `Insert any address` - Введите адрес вашего смарт-контракта здесь.
- `Enter raw input data` - Введите `callData` функции вашего контракта (сразу после `callData = encodeFunctionData()`)

<Accordion title="Развернуть для просмотра изображений (кликните для увеличения)">
<Frame caption="Tenderly - Отладка контракта">
<img
  src="/images/paymaster/pb-paymaster-tenderly-dev-debug.png"
  width="700"
  alt="Tenderly Debug"
/>
</Frame>
</Accordion>

## Неверный идентификатор цепи 

Возможно, вы используете RPC URL основной сети вместо тестовой (или наоборот). Убедитесь, что вы выбрали правильную сеть в портале CDP.

<Accordion title="Развернуть для просмотра изображений (кликните для увеличения)">
<Frame caption="Paymaster chain">
<img
  src="/images/paymaster/pb-paymaster-chainid.png"
  width="700"
  alt="Paymaster Chain ID"
/>
</Frame>
</Accordion>

## Недействительная подпись UserOperation или подпись paymaster

```
UserOperation rejected because account signature check failed (or paymaster signature, if the paymaster uses its data as signature).
```

Вероятно, это означает, что вы изменили UserOperation после получения подписи от нашего сервиса Paymaster. Наш Paymaster подписывает UserOperation самими данными UserOperation, поэтому убедитесь, что вы не вносите никаких изменений в UserOperation после того, как она уже была подписана нашим Paymaster (`paymasterClient.getPaymasterData()`). Если вам нужно скорректировать такие параметры, как `callData`, `preVerificationGas` или `callGasLimit`, вам потребуется получить новую подпись от нашего Paymaster. Также, если вы обрабатываете несколько UserOperations, убедитесь, что подпись paymaster соответствует правильной UserOperation.

