---
title: setupOnrampEventListeners
---

Утилита `setupOnrampEventListeners` настраивает обработчики событий (event listeners) для виджета Coinbase Onramp. Она помогает вам обрабатывать различные события, такие как успешные покупки, выходы и другие взаимодействия пользователя.

## Использование

<CodeGroup>
```tsx code
// @errors: 2305
import { setupOnrampEventListeners } from '@coinbase/onchainkit/fund';
import type { SuccessEventData, OnrampError, EventMetadata } from '@coinbase/onchainkit/fund';
const unsubscribe = setupOnrampEventListeners({
  onSuccess: (data: SuccessEventData) => {
    console.log('Purchase successful:', data);
  },
  onExit: (error: OnrampError) => {
    if (error) {
      console.error('Exit with error:', error);
    }
  },
  onEvent: (event: EventMetadata) => {
    console.log('Event received:', event);
  },
});

// Очистка по завершении
unsubscribe();

````

```ts return value
// Возвращает функцию отписки (unsubscribe function)
() => void
````

</CodeGroup>

## Параметры

```typescript
{
  host?: string;                                   // Необязательный URL кастомного хоста
  onSuccess?: (data?: SuccessEventData) => void;  // Коллбэк успешного завершения
  onExit?: (error?: OnrampError) => void;         // Коллбэк выхода
  onEvent?: (event: EventMetadata) => void;       // Общий коллбэк событий
}
```

## Возвращает

`() => void` - Возвращает функцию отписки (unsubscribe function), которая удаляет обработчики событий при вызове.

## Типы событий

```typescript
type SuccessEventData = {
  assetImageUrl: string;
  assetName: string;
  assetSymbol: string;
  chainId: string;
};

type OnrampError = {
  errorType:
    | 'internal_error'
    | 'handled_error'
    | 'network_error'
    | 'unknown_error';
  code?: string;
  debugMessage?: string;
};

type EventMetadata =
  | OpenEvent
  | TransitionViewEvent
  | PublicErrorEvent
  | ExitEvent
  | SuccessEvent
  | RequestOpenUrlEvent;

type OpenEvent = {
  eventName: 'open';
  widgetName: string;
};

type TransitionViewEvent = {
  eventName: 'transition_view';
  pageRoute: string;
};

type PublicErrorEvent = {
  eventName: 'error';
  error: OnrampError;
};

type ExitEvent = {
  eventName: 'exit';
  error?: OnrampError;
};

type SuccessEvent = {
  eventName: 'success';
  data?: SuccessEventData;
};

type RequestOpenUrlEvent = {
  eventName: 'request_open_url';
  url: string;
};
```
