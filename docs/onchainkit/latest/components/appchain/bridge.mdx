---
title: "AppchainBridge"
---

import { Danger } from "/snippets/danger.mdx";

<Danger>
**⚠️ ПРИМЕЧАНИЕ**

Компонент AppchainBridge - это программное обеспечение альфа-релиза и предоставляется КАК ЕСТЬ. Используйте на свой страх и риск.

</Danger>

Переводите токены в аппчейны с помощью простого, кастомизируемого интерфейса.

## Использование

Создайте кастомную цепь для вашего аппчейна, используя функцию [defineChain](https://viem.sh/docs/chains/introduction#custom-chains) от Viem, затем добавьте её в вашу конфигурацию Wagmi.

<CodeGroup>
```tsx chain.ts
import { defineChain } from 'viem';

export const EXAMPLE_CHAIN = defineChain({
  id: 8453200000, // [!code ++]
  name: 'Your Appchain Network',
  nativeCurrency: {
    name: 'Ethereum',
    symbol: 'ETH',
    decimals: 18,
  },
  rpcUrls: {
    default: {
      http: ['https://your-rpc.appchain.base.org'], // [!code ++]
    },
  },
});
```
```tsx providers.tsx
import { defineChain } from 'viem';

const EXAMPLE_CHAIN = defineChain({
  id: 8453200000,
  name: 'Your Appchain Network',
  nativeCurrency: {
    name: 'Ethereum',
    symbol: 'ETH',
    decimals: 18,
  },
  rpcUrls: {
    default: {
      http: ['https://your-rpc.appchain.base.org'],
    },
  },
});
// ---cut-before---
'use client';

import { baseSepolia } from 'wagmi/chains';
import { OnchainKitProvider } from '@coinbase/onchainkit';
import type { ReactNode } from 'react';
import { createConfig, http, WagmiProvider } from 'wagmi';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';

const wagmiConfig = createConfig({
  chains: [baseSepolia, EXAMPLE_CHAIN], // [!code ++]
  transports: {
    [baseSepolia.id]: http(),
    [EXAMPLE_CHAIN.id]: http(), // [!code ++]
  }
});

const queryClient = new QueryClient();

export function Providers(props: { children: ReactNode }) {
  return (
    <OnchainKitProvider
      apiKey={process.env.NEXT_PUBLIC_ONCHAINKIT_API_KEY}
          chain={baseSepolia}
          config={{ appearance: {
            mode: 'auto',
        }
      }}
    >
      <WagmiProvider config={wagmiConfig}>
        <QueryClientProvider client={queryClient}>
          {props.children}
        </QueryClientProvider>
      </WagmiProvider>
    </OnchainKitProvider>
  );
}
```
</CodeGroup>

Используйте кастомную цепь для создания объекта `Appchain`. Вы также можете отобразить иконку в UI, используя свойство `icon`.

```tsx
import { defineChain } from 'viem';
const EXAMPLE_CHAIN = defineChain({
  id: 8453200000, // [!code ++]
  name: 'Your Appchain Network',
  nativeCurrency: {
    name: 'Ethereum',
    symbol: 'ETH',
    decimals: 18,
  },
  rpcUrls: {
    default: {
      http: ['https://your-rpc.appchain.base.org'], // [!code ++]
    },
  },
});
// ---cut-before---
import type { Appchain } from '@coinbase/onchainkit/appchain';

const EXAMPLE_APPCHAIN: Appchain = {
  chain: EXAMPLE_CHAIN,
  icon: <img src="https://some-icon.com/icon.png" alt="Your Appchain Network" />,
};
```
Теперь вы можете отрендерить компонент `AppchainBridge` с свойствами `chain` и `appchain`.

```tsx
import { defineChain } from 'viem';
const EXAMPLE_CHAIN = defineChain({
  id: 8453200000, // [!code ++]
  name: 'Your Appchain Network',
  nativeCurrency: {
    name: 'Ethereum',
    symbol: 'ETH',
    decimals: 18,
  },
  rpcUrls: {
    default: {
      http: ['https://your-rpc.appchain.base.org'], // [!code ++]
    },
  },
});
import type { Appchain } from '@coinbase/onchainkit/appchain';

const EXAMPLE_APPCHAIN: Appchain = {
  chain: EXAMPLE_CHAIN,
  icon: <img src="https://some-icon.com/icon.png" alt="Your Appchain Network" />,
};
// ---cut-before---
import { AppchainBridge } from '@coinbase/onchainkit/appchain';
import { baseSepolia } from 'viem/chains';

<AppchainBridge chain={baseSepolia} appchain={EXAMPLE_APPCHAIN} />
```
## Кастомные токены для перевода

По умолчанию для перевода доступен только нативный ETH. Добавьте кастомные токены, используя свойство `bridgeableTokens`:

```tsx
import { defineChain } from 'viem';
const EXAMPLE_CHAIN = defineChain({
  id: 8453200000, // [!code ++]
  name: 'Your Appchain Network',
  nativeCurrency: {
    name: 'Ethereum',
    symbol: 'ETH',
    decimals: 18,
  },
  rpcUrls: {
    default: {
      http: ['https://your-rpc.appchain.base.org'], // [!code ++]
    },
  },
});
import type { Appchain } from '@coinbase/onchainkit/appchain';

const EXAMPLE_APPCHAIN: Appchain = {
  chain: EXAMPLE_CHAIN,
  icon: <img src="https://some-icon.com/icon.png" alt="Your Appchain Network" />,
};
// ---cut-before---
import type { BridgeableToken } from '@coinbase/onchainkit/appchain';

const customBridgeableTokens: BridgeableToken[] = [
  {
    name: 'ETH',
    address: '',
    symbol: 'ETH',
    decimals: 18,
    image:
    'https://wallet-api-production.s3.amazonaws.com/uploads/tokens/eth_288.png',
    chainId: 8453200000,
  },
  {
    address: '0x...',
    remoteToken: '0x...',
    name: 'Appchain Token',
    symbol: 'ATKN',
    decimals: 18,
    chainId: 8453200000,
    image: 'https://some-icon.com/icon.png',
  },
];
```
<Warning>
**⚠️ Что такое remoteToken?**

Поле `remoteToken` представляет адрес токена в аппчейне, в который вы переводите средства.

ERC-20 токены в аппчейне должны соответствовать интерфейсу `IOptimismMintableERC20`, чтобы быть доступными для перевода.

Следуйте [Optimism documentation](https://docs.optimism.io/app-developers/tutorials/bridging/standard-bridge-standard-token#create-an-l2-erc-20-token) чтобы получить адрес `remoteToken` для вашего ERC-20 токена.

</Warning>

Затем вы можете передать `customBridgeableTokens` в компонент `AppchainBridge` с помощью свойства `bridgeableTokens`.

```tsx
import type { BridgeableToken } from '@coinbase/onchainkit/appchain';

const customBridgeableTokens: BridgeableToken[] = [
  {
    name: 'ETH',
    address: '',
    symbol: 'ETH',
    decimals: 18,
    image:
    'https://wallet-api-production.s3.amazonaws.com/uploads/tokens/eth_288.png',
    chainId: 84532,
  },
  {
    address: '0x...',
    remoteToken: '0x...',
    name: 'Sandbox Token',
    symbol: 'SBOX',
    decimals: 18,
    chainId: 8453200058,
    image: 'https://img.cryptorank.io/coins/blocklords1670492311588.png',
  },
];
// ---cut-before---
import { AppchainBridge } from '@coinbase/onchainkit/appchain';
import { baseSepolia } from 'viem/chains';

<AppchainBridge
  chain={baseSepolia}
  appchain={SANDBOX_APPCHAIN}
  bridgeableTokens={customBridgeableTokens} // [!code ++]
/>
```

### Кастомные газовые токены

Для цепей, использующих кастомные газовые токены, установите `isCustomGasToken:`:

```tsx
import type { BridgeableToken } from '@coinbase/onchainkit/appchain';

const customGasToken: BridgeableToken[] = [
  {
    address: '0x...',
    remoteToken: '0x...',
    name: 'Appchain Token',
    symbol: 'ATKN',
    decimals: 18,
    chainId: 8453200000,
    image: 'https://some-icon.com/icon.png',
    isCustomGasToken: true, // [!code ++]
  },
];
```

### Кастомное получение цены

Переопределите `handleFetchPrice`, чтобы получать цены для кастомных токенов. Вызывается каждый раз, когда пользователь изменяет вводимую сумму:

```ts
(amount: string, token: Token) => Promise<string>;
```
```tsx
import { AppchainBridge } from '@coinbase/onchainkit/appchain';
import type { Token } from '@coinbase/onchainkit/token';
import { baseSepolia } from 'viem/chains';

const handleFetchPrice = async (amount: string, token: Token): Promise<string> => {
  // Пример: получение цены из вашего API
  const response = await fetch(`https://api.example.com/price/${token.address}`);
  const priceData = await response.json();
  return (parseFloat(amount) * priceData.price).toString();
};

<AppchainBridge
  chain={baseSepolia}
  appchain={EXAMPLE_APPCHAIN}
  bridgeableTokens={customBridgeableTokens}
  handleFetchPrice={handleFetchPrice} // [!code ++]
/>
```
## Компоненты

- `AppchainBridge` - Полный интерфейс для депозитов и выводов
- `AppchainBridgeProvider` - Headless-провайдер для контекста моста
- `AppchainBridgeInput` - Компонент ввода суммы
- `AppchainBridgeNetwork` - Выбор и отображение сети
- `AppchainBridgeTransactionButton` - Кнопка запуска транзакции
- `AppchainBridgeWithdraw` - Интерфейс для вывода
- `AppchainNetworkToggleButton` - Кнопка переключения сети
- `AppchainBridgeSuccess` - Отображение состояния успеха
- `AppchainBridgeResumeTransaction` - Возобновление прерванных транзакций

## Свойства

### Appchain

```ts
export type Appchain = {
  /** Цепь, в которую осуществляется перевод. */
  chain: Chain;
  /** Опциональная иконка для отображения аппчейна. */
  icon?: React.ReactNode;
};
```

### AppchainBridgeProps

```ts
export type AppchainBridgeProps = {
  /** Исходная цепь, с которой осуществляется перевод. Должна быть Base или Base Sepolia. */
  chain: Chain;
  /** Appchain, в который осуществляется перевод. */
  appchain: Appchain;
  /** Опциональные дочерние элементы для рендеринга внутри компонента. */
  children?: React.ReactNode;
  /** Опциональное переопределение className для компонента. */
  className?: string;
  /** Опциональный заголовок компонента. */
  title?: string;
  /** Опциональный массив токенов, доступных для перевода. */
  bridgeableTokens?: BridgeableToken[];
  /** Опциональная функция для получения цены токена. */
  handleFetchPrice?: (amount: string, token: Token) => Promise<string>;
};
```

### AppchainBridgeProviderProps

```ts
export type AppchainBridgeProviderProps = {
  children: ReactNode;
  chain: Chain;
  appchain: Appchain;
  bridgeableTokens?: BridgeableToken[];
  handleFetchPrice?: (amount: string, token: Token) => Promise<string>;
};
```

### AppchainBridgeContextType

```ts
export type AppchainBridgeContextType = {
  // Конфигурация
  config: AppchainConfig;
  from: ChainWithIcon;
  to: ChainWithIcon;
  bridgeParams: BridgeParams;
  bridgeableTokens: BridgeableToken[];

  // Состояние UI
  isPriceLoading: boolean;
  isAddressModalOpen: boolean;
  isWithdrawModalOpen: boolean;
  isSuccessModalOpen: boolean;
  isResumeTransactionModalOpen: boolean;
  balance: string;
  depositStatus: string;
  withdrawStatus: string;
  direction: string;
  depositTransactionHash?: Hex;
  finalizedWithdrawalTxHash?: Hex;
  resumeWithdrawalTxHash?: Hex;

  // Функции-обработчики
  handleToggle: () => void;
  handleAmountChange: (params: { amount: string; token: Token }) => void;
  handleAddressSelect: (address: Address) => void;
  handleResumeTransaction: (txHash: Hex) => void;
  handleDeposit: () => void;
  handleWithdraw: () => void;
  handleOpenExplorer: () => void;
  handleResetState: () => void;
  waitForWithdrawal: (txHash?: Hex) => Promise<void>;
  proveAndFinalizeWithdrawal: () => Promise<void>;
  setIsAddressModalOpen: (open: boolean) => void;
  setIsWithdrawModalOpen: (open: boolean) => void;
  setIsSuccessModalOpen: (open: boolean) => void;
  resetDepositStatus: () => void;
  setResumeWithdrawalTxHash: (txHash: Hex) => void;
  setIsResumeTransactionModalOpen: (open: boolean) => void;
};
```

### BridgeableToken

```ts
export type BridgeableToken = Token & {
  /** Адрес удаленного токена в аппчейне. */
  remoteToken?: Address;
  /** Опциональный флаг, указывающий, использует ли цепь кастомный газовый токен */
  isCustomGasToken?: boolean;
};
```

### ChainWithIcon
```ts
export type ChainWithIcon = Chain & {
  icon: React.ReactNode;
};
```

### AppchainConfig
```ts
export type AppchainConfig = {
  chainId: number;
  /** Адреса контрактов OP Bedrock для аппчейна. Они находятся в Base и получаются из DeployContract. */
  contracts: {
    l2OutputOracle: Address;
    systemConfig: Address;
    optimismPortal: Address;
    l1CrossDomainMessenger: Address;
    l1StandardBridge: Address;
    l1ERC721Bridge: Address;
    optimismMintableERC20Factory: Address;
  };
};
```

### AppchainBridgeSuccessProps

```ts
export type AppchainBridgeSuccessProps = {
  title?: string;
  primaryButtonLabel?: string;
  secondaryButtonLabel?: string;
};
```

### BridgeParams

```ts
export type BridgeParams = {
  amount: string;
  amountUSD: string;
  token: BridgeableToken;
  recipient?: Address;
};
```

### ChainConfigParams
```ts
export type ChainConfigParams = {
  config: AppchainConfig;
  chain: Chain;
};
```

### UseDepositParams
```ts
export type UseDepositParams = {
  config: AppchainConfig;
  from: Chain;
  bridgeParams: BridgeParams;
};
```

### UseWithdrawParams
```ts
export type UseWithdrawParams = {
  config: AppchainConfig;
  chain: Chain;
  bridgeParams: BridgeParams;
};
```

### UseDepositButtonParams
```ts
export type UseDepositButtonParams = {
  depositStatus: string;
  withdrawStatus: string;
  bridgeParams: BridgeParams;
};
```

### UseWithdrawButtonParams
```ts
export type UseWithdrawButtonParams = {
  withdrawStatus: string;
};
```
